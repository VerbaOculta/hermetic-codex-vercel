<script type="module">
  import { createAppIframeSDK } from 'https://cdn.skypack.dev/@whop/sdk';

  const infoDiv = document.getElementById("info");

  const sdk = createAppIframeSDK();

  sdk.onReady(async () => {
    const token = await sdk.getUserToken();
    if (!token) {
      infoDiv.innerText = "No se pudo obtener token Whop.";
      return;
    }

    const res = await fetch('/api/experience', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ token }),
    });

    const data = await res.json();

    if (data.error) {
      infoDiv.innerText = `Error: ${data.error}`;
    } else {
      infoDiv.innerHTML = `
        <p><strong>ID:</strong> ${data.user?.id || 'Sin ID'}</p>
        <p><strong>Email:</strong> ${data.user?.email || 'No disponible'}</p>
        <p><strong>Username:</strong> ${data.user?.username || 'Desconocido'}</p>
      `;
    }
  });
</script>
