<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Codex Hermético</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Cinzel+Decorative:wght@700&display=swap"
      rel="stylesheet"
    />

    <style>
      html,
      body {
        margin: 0;
        padding: 2rem;
        /*background: linear-gradient(to bottom, #0D0D0D, #1A1A2E);*/
        background: linear-gradient(309deg, #0d0d0d 44%, #0e1a36 82%);
        background: linear-gradient(to bottom, #0a0a14, #0e0e1d);
        color: #fff;
        font-family: "Playfair Display", serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }

      *,
      *::before,
      *::after {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body.mystic-glow {
        animation: glowFade 1.5s ease-in-out;
      }

      @keyframes glowFade {
        0% {
          box-shadow: inset 0 0 100px rgba(255, 215, 0, 0.2);
          background-color: #1f1a2e;
        }

        50% {
          box-shadow: inset 0 0 200px rgba(255, 215, 0, 0.4);
          background-color: #292042;
        }

        100% {
          box-shadow: inset 0 0 100px rgba(255, 215, 0, 0.2);
          background-color: #1a1a2e;
        }
      }

      h2 {
        font-size: 1.5rem;
        color: #ffd700;
        margin: 2rem 0 1rem;
        text-align: center;
        font-family: "Cinzel Decorative", cursive;
      }

      @media (max-width: 600px) {
        h2 {
          font-size: 1rem;
          margin: 1rem 0 0rem;
        }
      }

      /* === CARRUSEL === */

      .carousel-container {
        display: flex;
        flex-wrap: nowrap;
        gap: 1rem;
        padding: 1rem 0;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        justify-content: center;
        /* valor por defecto para pantallas grandes */
        overflow-x: auto;
        max-width: 100%;
        padding-left: 1rem;
        padding-right: 1rem;
      }

      @media (max-width: 600px) {
        .carousel-container {
          justify-content: flex-start;
        }
      }

      .carousel-container .card {
        flex: 0 0 auto;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border-radius: 16px;
      }

      .carousel-container .card.selected {
        transform: scale(1.05);
        box-shadow: 0 0 20px 6px rgba(255, 215, 0, 0.5);
        /* resplandor visible */
        z-index: 1;
      }

      .card {
        flex: 0 0 auto;
        width: 80px;
        scroll-snap-align: center;
        cursor: pointer;
        position: relative;
        transition: transform 0.3s;
      }

      .card img {
        width: 100%;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        transition: box-shadow 0.3s ease, transform 0.3s ease;
      }

      .card:hover img {
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
        transform: scale(1.05);
      }

      .card.selected img {
        box-shadow: 0 0 20px rgba(255, 215, 0, 1);
        transform: scale(1.1);
      }

      .card-title {
        position: absolute;
        bottom: 8px;
        left: 0;
        right: 0;
        text-align: center;
        font-size: 0.75rem;
        background: rgba(0, 0, 0, 0.6);
        padding: 4px;
        border-radius: 0 0 10px 10px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .card:hover .card-title {
        opacity: 1;
      }

      @media (max-width: 600px) {
        .card {
          width: 65px;
        }

        .card-title {
          font-size: 0.6rem;
        }

        .button-container {
          display: flex;
          justify-content: center;
          align-items: center;
        }
      }

      /* === BOTÓN === */
      .button-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 2rem;
        margin-bottom: 2.5rem;
        /* ← NUEVO: espacio inferior */
        width: 100%;
      }

      .btn-continue {
        display: none;

        font-family: "Cinzel Decorative", cursive;
        font-size: 1.1rem;
        background: linear-gradient(90deg, #a472f7, #ff5ea5);
        border: 2px solid #ffd700;
        color: #fff;
        padding: 0.8rem 1.5rem;
        border-radius: 1rem;
        cursor: pointer;
        box-shadow: 0 0 12px #ffd70055;
        transition: all 0.3s ease;
        text-transform: uppercase;
        margin-top: 15px;
        /*

  background: radial-gradient(circle at center, #FFD700 0%, #b38600 100%);
  color: #1A1A2E;
  border: 1px solid #FFD700;
  padding: 10px 24px;
  font-size: 1rem;
  font-family: 'Cinzel Decorative', cursive;
  letter-spacing: 1px;
  cursor: pointer;
  border-radius: 8px;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
  transition: all 0.4s ease;
  text-transform: uppercase;*/
      }

      /*
.btn-continue:hover {
  background: #FFD700;
  color: #000;
  box-shadow: 0 0 25px rgba(255, 215, 0, 0.7);
}*/

      .btn-continue:hover {
        transform: scale(1.05);
        background: linear-gradient(90deg, #c394ff, #ff79b2);
      }

      .btn-continue.active {
        display: inline-block;
      }

      #interpretation {
        background: #0a0a0a;
        border: 0.2px solid #ffd700;
        /*box-shadow: 0 0 12px rgba(255, 215, 0, 0.2), 0 0 25px rgba(255, 215, 0, 0.1) inset;*/
        border-radius: 1.5rem;
        max-width: 480px;
        margin: 1rem auto;
        padding: 1.2rem;
        text-align: center;
        display: none;
      }

      /* === NUEVO BLOQUE VERTICAL === */
      .card-interpretation-block.vertical {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1.2rem;
        margin: 2rem auto;
        padding: 1.2rem 1rem;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        border-radius: 16px;
        background: none;
        font-weight: 400;
        color: #eaeaea;
      }

      .card-interpretation-block.vertical .static-card {
        width: 105px;
        max-width: 100%;
        border-radius: 12px;
        background: none;
        padding: 0;
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        filter: drop-shadow(0 0 10px gold);
      }

      .card-interpretation-block.vertical .interpretation-text {
        background: rgba(255, 255, 255, 0.05);
        border-left: none;
        border-top: 1px solid gold;
        padding: 1.2rem 1.5rem;
        border-radius: 12px;
        color: #ffd700;
        font-family: "Playfair Display", serif;
        text-align: justify;
        max-width: 100%;
        background: rgba(0, 0, 0, 0.3);
      }

      .card-interpretation-block.vertical .interpretation-text h3 {
        font-family: "Cinzel Decorative", cursive;
        color: gold;
        text-align: center;
        text-transform: uppercase;
        font-size: 1.6rem;
        margin-bottom: 1.2rem;
        border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        padding-bottom: 0.3rem;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
      }

      .card-interpretation-block.vertical .interpretation-text p {
        text-align: justify;
        line-height: 1.75;
      }

      @media (max-width: 600px) {
        .card-interpretation-block.vertical .interpretation-text p {
          text-align: left;
          line-height: 1.6;
        }
      }

      .card-interpretation-block.vertical .interpretation-text p:first-letter {
        font-size: 2.4rem;
        font-weight: bold;
        color: #ffd700;
        float: left;
        margin-right: 0.4rem;
        line-height: 1;
      }

      .card.static-card {
        background: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        margin: 0 auto;
        display: flex;
        justify-content: center;
        border: none !important;
        margin-bottom: 1.5rem;
      }

      .card.static-card img {
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        border-radius: 10px;
      }

      .card-interpretation-block.vertical:hover {
        box-shadow: 0 0 25px rgba(255, 215, 0, 0.3);
        transform: translateY(-2px);
      }

      /* === OTROS === */
      .symbol-loading {
        width: 80px;
        height: 80px;
        margin: 2rem auto;
        border: 4px solid rgba(255, 215, 0, 0.2);
        border-top: 4px solid gold;
        border-radius: 50%;
        animation: spin 1.2s linear infinite;
      }

      #selectedCardsView {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 2rem;
      }

      .hidden {
        display: none !important;
        height: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        overflow: hidden !important;
      }

      .hidden-space {
        height: 0 !important;
        opacity: 0 !important;
        overflow: hidden !important;
        margin: 0 !important;
        padding: 0 !important;
        pointer-events: none;
      }

      @keyframes glowPulse {
        0% {
          box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        50% {
          box-shadow: 0 0 40px rgba(255, 215, 0, 1);
        }

        100% {
          box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
      }

      @keyframes fadeInOut {
        0% {
          opacity: 0;
        }

        20% {
          opacity: 1;
        }

        80% {
          opacity: 1;
        }

        100% {
          opacity: 0;
        }
      }

      .glow-temp img {
        animation: glowPulse 2s ease-in-out infinite;
      }

      .symbol {
        width: 80px;
        height: 80px;
        background: url("https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/gdwgon2513836.png")
          no-repeat center;
        background-size: contain;
        filter: brightness(0) saturate(100%) invert(65%) sepia(79%)
          saturate(400%) hue-rotate(5deg) brightness(95%) contrast(90%);
        animation: spin 3s linear infinite;
        margin: 2rem auto;
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }

        to {
          transform: rotate(360deg);
        }
      }
    </style>

    <style>
      .quiz-container {
        max-width: 480px;
        margin: 1rem auto 1rem;
        padding: 1.2rem;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 16px;
        color: #ffd700;
        font-family: "Playfair Display", serif;
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.15);
        /* resplandor tenue */
        display: none;
        animation: fadeInUp 1s ease forwards;
        opacity: 0;
      }

      @keyframes fadeInUp {
        0% {
          opacity: 0;
          transform: translateY(30px);
        }

        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .quiz-container h2 {
        display: block !important;
        font-family: "Cinzel Decorative", cursive;
        font-size: 1.5rem;
        text-align: center;
        margin-bottom: 1rem;
        color: gold;
        line-height: 1.6;
        text-shadow: 0 0 4px rgba(255, 215, 0, 0.25);
      }

      .quiz-options {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin: 1.2rem 0;
      }

      .quiz-option {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 215, 0, 0.2);
        padding: 1rem;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1rem;
        outline: none;
      }

      .quiz-option.selected {
        background: linear-gradient(90deg, #ffdd00, #ff66c4);
        color: black;
        font-weight: bold;
        box-shadow: 0 0 20px #ffcc00;
      }

      .quiz-option:focus {
        outline: 2px solid gold;
      }

      .quiz-continue {
        display: block;
        margin: 1.5rem auto 0;
        background: gold;
        color: black;
        font-family: "Cinzel Decorative", cursive;
        font-size: 1rem;
        padding: 0.8rem 2rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .quiz-continue:hover {
        background: #ffd700;
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
      }

      .quiz-option {
        opacity: 0;
        transform: translateY(30px);
        animation: fadeInUp 0.5s forwards;
      }

      .quiz-option:nth-child(1) {
        animation-delay: 0.1s;
      }

      .quiz-option:nth-child(2) {
        animation-delay: 0.2s;
      }

      .quiz-option:nth-child(3) {
        animation-delay: 0.3s;
      }

      .quiz-option:nth-child(4) {
        animation-delay: 0.4s;
      }

      .quiz-option:nth-child(5) {
        animation-delay: 0.5s;
      }

      @keyframes fadeInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .revelation-section {
        display: none;
        text-align: center;
        margin-top: 3rem;
        padding: 2rem;
        background: rgba(0, 0, 0, 0.5);
        /* fondo translúcido */
        border: 0px solid gold;
        border-radius: 16px;
        box-shadow: 0 0 25px rgba(255, 215, 0, 0.12);
        /* borde suave */
        animation: fadeIn 1.5s ease forwards;
        opacity: 0;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
      }

      .revelation-section h3 {
        color: gold;
        font-family: "Cinzel Decorative", cursive;
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
      }

      @keyframes fadeIn {
        0% {
          opacity: 0;
          transform: scale(0.98);
        }

        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes pulse-glow {
        0% {
          box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        50% {
          box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
        }

        100% {
          box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
      }

      .revelation-section.visible {
        display: block;
      }

      .form-section {
        border: 0.2px solid gold;
        display: none;
        margin-top: 2rem;
        text-align: center;
        color: white;
        border-radius: 1rem;
        max-width: 480px;
        margin: 3rem auto;
        padding: 1.2rem;
      }

      .form-section.visible {
        display: block;
      }
    </style>

    <style>
      .synthesis-box {
        background: linear-gradient(#0c0c0c, #141414);
        border: 1px solid gold;
        border-radius: 1rem;
        padding: 2rem;
        margin: 3rem auto;
        max-width: 680px;
        box-shadow: 0 0 25px rgba(255, 215, 0, 0.3);
        opacity: 0;
        transform: translateY(30px);
        transition: all 1s ease;
      }

      .synthesis-box.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .synthesis-box p {
        color: #ffd700;
        font-weight: 400;
        font-size: 1.1rem;
        line-height: 1.9;
        text-align: justify;
        margin-bottom: 1.5rem;
      }

      .synthesis-title {
        font-family: "Cinzel Decorative";
        text-align: center;
        color: #ffd700;
        font-size: 1.5rem;

        font-weight: 700;

        text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);

        text-align: center;
        font-style: normal;

        /*text-shadow: 0 0 10px gold, 0 0 25px rgba(255, 215, 0, 0.2);*/
        margin-bottom: 0.8rem;
        text-transform: uppercase;
      }

      .interpretation-final-body p {
        margin-bottom: 1.5rem;
      }

      .interpretation-final-body p:first-of-type::first-letter {
        float: left;
        font-size: 2.4rem;
        font-weight: bold;
        color: gold;
        margin-right: 0.4rem;
        line-height: 1;
        margin-top: 0 !important;
      }

      .interpretation-final-wrapper::-webkit-scrollbar {
        width: 8px;
      }

      .interpretation-final-wrapper::-webkit-scrollbar-thumb {
        background: rgba(255, 215, 0, 0.4);
        border-radius: 4px;
      }

      @keyframes fadeInUp {
        0% {
          opacity: 0;
          transform: translateY(30px);
        }

        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .interpretation-final-title {
        text-align: center;
        font-size: 2rem;
        font-weight: bold;
        font-style: italic;
        text-shadow: 0 0 6px gold;
        margin-bottom: 0.5rem;
      }

      .interpretation-divider {
        border: 0;
        height: 1px;
        background: gold;
        margin: 0 auto 1.2rem;
        width: 80%;
      }

      .interpretation-final-body {
        font-size: 1.2rem;

        font-style: italic;
        color: #ffd700;
        text-align: left;
        line-height: 1.9;
        /* o incluso 1.9 si lo deseas más etéreo */
      }

      .interpretation-final-body p:first-of-type::first-letter {
        float: left;
        font-size: 2.4rem;
        font-weight: bold;
        color: gold;
        margin-right: 0.4rem;
        line-height: 1;
      }

      .interpretation-final-body p {
        margin-bottom: 1.2rem;
        line-height: 1.8;
      }

      .hidden-space {
        height: 0 !important;
        opacity: 0 !important;
        overflow: hidden !important;
        margin: 0 !important;
        padding: 0 !important;
        pointer-events: none;
        display: none !important;
      }

      #interpretacion-anchor {
        width: 100%;
        display: block;
        padding: 1.2rem, 0rem, 0rem, 0rem;
      }

      .interpretation-loading-text {
        text-align: center;
        /*font-style: italic;*/
        font-size: 1.3rem;
        color: #ffd700;
        margin-bottom: 0.5rem;
        line-height: 1.6;
        animation: fadeIn 1.5s ease forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .magic-message {
        display: none;
        position: fixed;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.85);
        padding: 1rem 2rem;
        border: 1px solid gold;
        border-radius: 10px;
        color: #ffd700;
        font-size: 1.2rem;
        font-family: "Playfair Display", serif;
        text-align: center;
        z-index: 9999;
        max-width: 90%;
        width: fit-content;
        animation: fadeInOut 3s ease forwards;
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
      }

      #revelation {
        background-color: #111;
        /*padding: 32px 20px;*/
        border-radius: 24px;
        margin: 30px auto 0;
        max-width: 480px;
        border: 0.2px solid #ffd700;
        padding: 0.1rem 1.2rem 1.2rem 1.2rem;
      }

      #finalSynthesisText {
        font-family: "Playfair Display", serif;
        /*font-style: italic;*/
        font-size: 1.15rem;
        color: #eaeaea;
        text-align: center;
        /*background: rgba(0, 0, 0, 0.5);*/
        border: none;
        border-radius: 18px;
        padding: 0px 24px 32px 24px;
        max-width: 480px;
        line-height: 1.9;
        font-weight: 400;
        opacity: 1;
        animation: fadeInUp 1s ease forwards;
      }

      #finalSynthesisSection h2.synthesis-title {
        margin-top: 0.5rem;
        margin-bottom: 1rem;
      }

      .interpretation-divider {
        border: 0;
        height: 1px;
        background: gold;
        margin: 1rem auto 1.5rem;
        width: 70%;
        box-shadow: 0 0 6px rgba(255, 215, 0, 0.3);
      }

      .carousel-wrapper {
        max-width: 95%;
        margin: 0 auto;
        padding: 0 1rem;
      }

      .codex-intro {
        border-radius: 1rem;
        padding: 2rem;
        margin-top: 1.8rem;
        margin-bottom: 2.5rem;
        max-width: 680px;
        opacity: 0;
        transform: translateY(30px);
        transition: all 1s ease;
        text-align: center;
        border: none;
      }

      .codex-intro.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .intro-title {
        font-family: "Cinzel Decorative", cursive;
        font-size: 1.5rem;
        font-weight: 700;
        letter-spacing: 0.5px;
        line-height: 1.6;
        margin-bottom: 1.5rem;
        color: #ffd700;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
        text-transform: uppercase;
      }

      .secondary-title {
        font-family: "Cinzel Decorative", cursive;
        font-size: 1.6rem;
        font-weight: 700;
        letter-spacing: 0.5px;
        line-height: 1.6;
        margin-bottom: 1.5rem;
        color: #ffd700;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        text-transform: none;
      }

      .intro-description {
        color: #dadada;
        /*color: #FFD700;*/
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.8;
        text-align: center;
        text-shadow: 0 0 6px rgba(255, 215, 0, 0.25);
        animation: fadeInText 2s ease-in-out forwards;
        opacity: 0;
        font-style: normal !important;
      }

      .intro-description p {
        margin-bottom: 0rem;
        /* Puedes probar también con 0.6rem o incluso 0.5rem */
      }

      .intro-description em {
        font-size: 1.8rem;
        display: inline-block;
        font-weight: bold;
        margin-top: 1rem;
        font-style: italic;
      }

      @keyframes fadeInText {
        from {
          opacity: 0;
          transform: translateY(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .final-choice-card {
        width: 120px;
        height: auto;
        margin: 1rem;
        padding: 0.5rem;
        border: 1px solid gold;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        background-color: #111;
        text-align: center;
        transition: transform 0.3s ease;
      }

      .final-choice-card img {
        width: 100%;
        height: auto;
        border-radius: 8px;
      }

      .final-choice-card:hover {
        transform: scale(1.08);
        cursor: pointer;
      }

      /* === CARTAS RESPONSIVAS: SIMPLES, UNA AL LADO DE LA OTRA EN TODOS LOS DISPOSITIVOS === */
      .revelation-cards {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        flex-wrap: wrap;
        gap: 1.5rem;
        margin-top: 2rem;
        padding: 1rem;
      }

      .revelation-cards .card {
        width: 100px;
        max-width: 100px;
        flex: 0 0 auto;
        border: 1px solid gold;
        border-radius: 12px;
        padding: 0.5rem;
        box-shadow: 0 0 12px rgba(255, 215, 0, 0.3);
        background-color: #111;
        text-align: center;
        transition: transform 0.3s ease;
      }

      @keyframes goldenPulse {
        0% {
          box-shadow: 0 0 20px 6px rgba(255, 215, 0, 0.4),
            inset 0 0 8px rgba(255, 215, 0, 0.2);
        }

        100% {
          box-shadow: 0 0 30px 12px rgba(255, 215, 0, 0.6),
            inset 0 0 14px rgba(255, 215, 0, 0.3);
        }
      }

      .revelation-cards .card.selected {
        transform: scale(1.15) !important;
        border: 3px solid #ffd700 !important;
        box-shadow: 0 0 40px gold !important;
        transition: all 0.4s ease-in-out;
        z-index: 5;
      }

      .revelation-cards .card img {
        width: 100%;
        height: auto;
        border-radius: 8px;
      }

      .revelation-cards .card .card-title {
        margin-top: 0.5rem;
        color: gold;
        font-weight: bold;
        font-size: 0.9rem;
      }

      .revelation-cards .card:hover {
        transform: scale(1.05);
        cursor: pointer;
      }

      .quiz-intro {
        margin-bottom: 2.5rem;
      }
    </style>

    <style>
      body {
        font-family: "Playfair Display", serif;
        color: #f8f0dc;
        background-color: #0a0a0a;
      }

      h1,
      h2,
      h3 {
        font-family: "Cinzel Decorative", cursive;
        text-transform: none;
      }

      .card-interpretation-block.vertical {
        border-radius: 20px;
        padding: 20px;
        margin: 20px auto;
        max-width: 480px;
        text-align: center;
        padding: 2rem 1.5rem;
      }

      .card-interpretation-block.vertical h3 {
        font-family: "Cinzel Decorative", cursive;
        font-size: 1.3rem;
        color: #ffd700;
        margin-bottom: 0.5rem;
        text-transform: none;
      }

      .card-interpretation-block.vertical p {
        font-size: 1rem;
        line-height: 1.6;
        color: #eaeaea;
      }

      .btn-alquimico,
      .btn-confirm {
        background: linear-gradient(90deg, #a472f7, #ff5ea5);
        border: 2px solid #ffd700;
        color: #fffaf0;
        font-family: "Cinzel Decorative", cursive;
        font-size: 1rem;
        padding: 12px 24px;
        border-radius: 12px;
        box-shadow: 0 0 10px #ffd70088, 0 0 20px #ff5ea577;
        cursor: pointer;
        text-transform: none;
        margin-top: 1rem;
        display: block;
        margin-left: auto;
        margin-right: auto;
      }

      #finalSynthesisSection {
        position: relative;
        background-image: url("https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/xajKuq4975608.jpeg");
        background-size: cover;
        background-position: center;
        border-radius: 24px;
        border: 0.2px solid #ffd700;
        padding: 2.5rem 1.5rem;
        margin: 30px auto 0;
        max-width: 480px;
        overflow: hidden;
        box-shadow: 0 0 60px rgba(255, 215, 0, 0.08);
        font-family: "Playfair Display", serif;
        z-index: 1;
      }

      #finalSynthesisSection::before {
        content: "";
        position: absolute;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.85);
        /* superposición oscura */
        z-index: 0;
      }

      #finalSynthesisSection > * {
        position: relative;
        z-index: 1;
      }

      .container {
        max-width: 720px;
        margin: auto;
        padding: 1.5rem;
      }

      .glow-box-intencion {
        background: #0a0a0a;
        border: 0.2px solid #ffd700;
        border-radius: 1.5rem;
        max-width: 480px;
        margin: 1rem auto 1rem;
        padding: 1.2rem 1.2rem 1.2rem 1.2rem;
        margin: 0 auto;
        text-align: center;
      }

      .quiz-title {
        font-family: "Cinzel Decorative", cursive;
        font-size: 1.5rem;
        color: #ffd700;
        margin-bottom: 1rem;
        text-shadow: 0 0 8px #ffc40088;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
      }

      .quiz-subtitle {
        font-family: "Playfair Display", serif;
        font-size: 1.1rem;
        color: #fef6e2;
        margin-bottom: 1.5rem;
        line-height: 1.6;
      }

      .quiz-option {
        transition: all 0.3s ease;
        border: 2px solid gold;
        border-radius: 12px;
        font-size: 1.1rem;
        padding: 1rem;
        margin: 0.75rem 0;
        background-color: transparent;
        color: #fcefc1;
        box-shadow: 0 0 8px rgba(255, 215, 0, 0.1);
      }

      .quiz-option:hover {
        background: linear-gradient(90deg, #8e44ad, #e91e63);
        color: white;
        box-shadow: 0 0 15px gold;
      }

      .intent-btn {
        background: linear-gradient(135deg, #1a1a1a, #000);
        border: 2px solid #ffd700;
        color: #fdf6e3;
        font-family: "Cinzel Decorative", cursive;
        font-size: 1rem;
        padding: 1rem 1.2rem;
        margin: 0.8rem auto;
        width: 100%;
        border-radius: 14px;
        transition: all 0.3s ease;
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
        display: flex;
        align-items: center;
        gap: 0.8rem;
        justify-content: flex-start;
        position: relative;
        text-align: left;
        line-height: 1.6;
        padding: 1.2rem 1.2rem;
        transition: all 0.3s ease-in-out;
      }

      .intent-btn:hover {
        /*box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);*/
        transform: scale(1.02);
        border-color: #fff2a8;
        background: radial-gradient(circle at center, #222 30%, #000 100%);
        border-color: #fff2a8;
        box-shadow: 0 0 15px #ffdd00cc;
      }

      .mt-4 {
        margin-top: 1.5rem;
      }

      .btn-alquimico {
        font-family: "Cinzel Decorative", cursive;
        font-size: 1.1rem;
        background: linear-gradient(90deg, #a472f7, #ff5ea5);
        border: 2px solid #ffd700;
        color: #fff;
        padding: 0.8rem 1.5rem;
        border-radius: 1rem;
        cursor: pointer;
        box-shadow: 0 0 12px #ffd70055;
        transition: all 0.3s ease;
        text-transform: uppercase;
        display: inline-block;
      }

      .btn-alquimico:hover {
        transform: scale(1.05);
        background: linear-gradient(90deg, #c394ff, #ff79b2);
      }

      .intent-btn.selected {
        background: linear-gradient(90deg, #fff5c2, #ff8cc2);
        color: #2b1b00;
        text-shadow: 0 0 1px #000;
        font-weight: 700;
        box-shadow: 0 0 25px #ffd700aa;
      }

      .intent-btn svg,
      .intent-btn::before {
        content: "✨";
        font-size: 1.2rem;
        color: #ffd700;
        margin-right: 0.5rem;
        display: inline-block;
      }

      .card.final-choice-card {
        transform: scale(1);
        transition: transform 0.3s ease;
        margin: 10px auto;
      }

      .dorado {
        color: #ffd700;
        font-weight: bold;
        text-shadow: 0 0 6px rgba(64, 224, 208, 0.25);
      }

      #animatedText p:first-of-type::first-letter {
        float: none;
        font-size: inherit;
        font-weight: inherit;
        color: inherit;
        margin-right: 0;
      }

      #simbolo-cierre {
        position: fixed;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        width: 120px;
        opacity: 0.6;
        z-index: 2147483647;
        pointer-events: none;
      }

      #overlay-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(10, 10, 10, 0.8);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 2147483647;
      }

      .overlay-content {
        text-align: center;
        color: #ffd700;
        font-size: 1.2rem;
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }

        to {
          transform: rotate(360deg);
        }
      }

      .intro-revelacion {
        font-family: "Playfair Display", serif;
        font-size: 1rem;
        color: #f0e6d2;
        text-align: center;
        max-width: 600px;
        margin: 0 auto 0.5rem auto;
        padding: 1rem 1rem;
        font-style: italic;
        line-height: 1.6;
      }

      #finalSynthesisText .loading {
        font-family: "Playfair Display", serif;
        font-size: 1rem;
        color: #eaeaea;
        text-align: center;
        max-width: 600px;
        margin: 0 auto 0.5rem auto;
        padding: 1rem 1rem;
        font-style: normal;
        line-height: 2;
      }
    </style>

    <!-- Meta Pixel Code para puerta-codex -->
    <script>
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod
            ? n.callMethod.apply(n, arguments)
            : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = "2.0";
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(
        window,
        document,
        "script",
        "https://connect.facebook.net/en_US/fbevents.js"
      );

      fbq("init", "619760977647376");
      fbq("track", "PageView");
      fbq("trackCustom", "codex_entry");
    </script>
    <noscript>
      <img
        height="1"
        width="1"
        style="display: none"
        src="https://www.facebook.com/tr?id=619760977647376&ev=PageView&noscript=1"
      />
    </noscript>
  </head>

  <body>
    <div id="overlay-loader" style="display: none">
      <div class="overlay-content">
        <div class="symbol"></div>
      </div>
    </div>

    <h2>The Way of the Alchemist</h2>
    <div class="carousel-wrapper">
      <div class="carousel-container">
        <div class="card" data-id="1">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/EvcQpI2534195.jpeg?w=640&q=75"
            alt="The Master of the Great Work"
          />
          <div class="card-title">The Master of the Great Work</div>
        </div>

        <div class="card" data-id="3">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/CtWlzk2534195.jpeg?w=640&q=75"
            alt="Genesis in the Retort"
          />
          <div class="card-title">Genesis in the Retort</div>
        </div>

        <div class="card" data-id="8">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/mzXXMC2534195.jpeg"
            alt="The Crypt of Rebirth"
          />
          <div class="card-title">The Crypt of Rebirth</div>
        </div>
        <div class="card" data-id="12">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/mJtfJH2534195.jpeg"
            alt="The Bath of the Red King"
          />
          <div class="card-title">The Bath of the Red King</div>
        </div>
        <div class="card" data-id="13">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/pdfLCl2534195.jpeg"
            alt="The Robe of the Soul"
          />
          <div class="card-title">The Robe of the Soul</div>
        </div>
        <div class="card" data-id="14">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/DLBPqw2534195.jpeg"
            alt="The Work Completed"
          />
          <div class="card-title">The Work Completed</div>
        </div>
        <div class="card" data-id="10">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/nCJjFD2534195.jpeg"
            alt="The Inner Labyrinth"
          />
          <div class="card-title">The Inner Labyrinth</div>
        </div>
        <div class="card" data-id="21">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/WNvcRP2534195.jpeg"
            alt="The Stone of Chaos"
          />
          <div class="card-title">The Stone of Chaos</div>
        </div>
        <div class="card" data-id="22">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/EHzxmw2534195.jpeg"
            alt="The Infinite Path"
          />
          <div class="card-title">The Infinite Path</div>
        </div>
        <div class="card" data-id="18">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/srtYYL2534195.jpeg"
            alt="The Sacred Dwelling"
          />
          <div class="card-title">The Sacred Dwelling</div>
        </div>
      </div>
    </div>

    <h2>The Universal Laws</h2>
    <div class="carousel-wrapper">
      <div class="carousel-container">
        <div class="card" data-id="6">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/KeAluq2534195.jpeg"
            alt="The Inner Sun"
          />
          <div class="card-title">The Inner Sun</div>
        </div>

        <div class="card" data-id="11">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/vmFlNG2534195.jpeg"
            alt="The Daughter of Water"
          />
          <div class="card-title">The Daughter of Water</div>
        </div>

        <div class="card" data-id="16">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/kBdqjf2534195.jpeg"
            alt="The Voice of Air"
          />
          <div class="card-title">The Voice of Air</div>
        </div>

        <div class="card" data-id="15">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/itywin2534195.jpeg"
            alt="The Philosophical Tree"
          />
          <div class="card-title">The Philosophical Tree</div>
        </div>
        <div class="card" data-id="7">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/xrJXYj2534195.jpeg"
            alt="	The Compass of the Wise"
          />
          <div class="card-title">The Compass of the Wise</div>
        </div>

        <div class="card" data-id="9">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/XdMAmo2534195.jpeg"
            alt="The Balance of Opposites"
          />
          <div class="card-title">The Balance of Opposites</div>
        </div>
        <div class="card" data-id="19">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/uDFgMI2534195.jpeg"
            alt="The Twin Sun"
          />
          <div class="card-title">The Twin Sun</div>
        </div>

        <div class="card" data-id="20">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/rthpYG2534195.jpeg"
            alt="Divine Geometry"
          />
          <div class="card-title">Divine Geometry</div>
        </div>
        <div class="card" data-id="4">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/vnenhs2534195.jpeg"
            alt="The Harmony of the Spheres"
          />
          <div class="card-title">The Harmony of the Spheres</div>
        </div>
      </div>
    </div>

    <h2>The Sealed Fragments</h2>
    <div class="carousel-wrapper">
      <div class="carousel-container">
        <div class="card" data-id="2">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/WXbiaf2534195.jpeg"
            alt="The Guardian of Silence"
          />
          <div class="card-title">The Guardian of Silence</div>
        </div>

        <div class="card" data-id="5">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/hxFYoC2534195.jpeg"
            alt="The Council of the Arcanes"
          />
          <div class="card-title">The Council of the Arcanes</div>
        </div>

        <div class="card" data-id="17">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/csLeJF2534195.jpeg"
            alt="The Cosmic Egg"
          />
          <div class="card-title">The Cosmic Egg</div>
        </div>

        <div class="card" data-id="23">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/rflFDD2534195.jpeg"
            alt="The Guardian of the Threshold"
          />
          <div class="card-title">The Guardian of the Threshold</div>
        </div>
        <div class="card" data-id="24">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/KzjuNX2534195.jpeg"
            alt="The Fortress of Brotherhood"
          />
          <div class="card-title">The Fortress of Brotherhood</div>
        </div>
        <div class="card" data-id="25">
          <img
            src="https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/XFsdYD2534195.jpeg"
            alt="The Living Circle"
          />
          <div class="card-title">The Living Circle</div>
        </div>
      </div>
    </div>

    <div class="button-container">
      <button class="btn-continue" id="continueButton">
        ✨ Reveal the Fragments
      </button>
      <button
        id="retryButton"
        style="
          display: none;
          margin-top: 1.5rem;
          padding: 10px 20px;
          font-size: 1rem;
          background: gold;
          color: black;
          border: none;
          border-radius: 6px;
          cursor: pointer;
        "
      >
        Retry Interpretation
      </button>
    </div>

    <section id="interpretacion-anchor"></section>

    <div id="magicMessage" class="magic-message"></div>

    <section class="glow-box-intencion" id="quizSection" style="display: none">
      <h2 class="quiz-title">
        WHAT FORCE DO YOU WISH TO ACTIVATE <br />FROM WITHIN?
      </h2>
      <p class="quiz-subtitle">
        The fragments have spoken...<br />
        The portal is open.<br />
        Now, choose the force you wish to manifest.
      </p>

      <div class="quiz-options">
        <button
          class="intent-btn"
          data-intent="Find my spiritual purpose"
          data-code="proposito"
        >
          Find my spiritual purpose
        </button>
        <button
          class="intent-btn"
          data-intent="Cultivate loving and conscious relationships"
          data-code="amor"
        >
          Cultivate loving and conscious relationships
        </button>
        <button
          class="intent-btn"
          data-intent="Attract abundance and financial security"
          data-code="abundancia"
        >
          Attract abundance and financial security
        </button>
        <button
          class="intent-btn"
          data-intent="Heal my emotional and physical world"
          data-code="salud"
        >
          Heal my emotional and physical world
        </button>
        <button
          class="intent-btn"
          data-intent="Awaken my inner power with self-confidence"
          data-code="transformacion"
        >
          Awaken my inner power with self-confidence
        </button>
      </div>

      <button class="btn-alquimico mt-4" id="quizContinue">✨ Continuar</button>
    </section>

    <div id="loadingSymbol" class="symbol" style="display: none"></div>

    <div id="finalSynthesisSection" class="hidden">
      <div id="finalSynthesisText" class="interpretation-final-wrapper visible">
        <div class="synthesis-title">
          THE CODEX HAS REVEALED THE SYNTHESIS OF YOUR PATH:
        </div>
        <p class="intro-revelacion">
          What unfolds before you is a symbolic and personal interpretation,
          shaped from the fragments you yourself selected. Each word is
          carefully woven to reflect your true intention and the phase of the
          journey you're now walking.
        </p>
        <div class="loading"></div>
        <!-- Esta línea debe estar -->
        <!-- Aquí se insertará dinámicamente el texto animado en <div id="animatedText"> -->
      </div>
    </div>

    <div class="hidden" id="revelation">
      <div class="codex-intro visible">
        <div class="intro-title">
          The Codex has revealed two paths before you...
        </div>
        <div class="quiz-subtitle">
          Only one leads to the Threshold of your True Transformation.
        </div>
      </div>

      <div class="revelation-cards"></div>
    </div>

    <div class="form-section" id="formSection">
      <style>
        @import url(https://fonts.bunny.net/css?family=cinzel-decorative:400,700|IBM+Plex+Sans:400);
      </style>
      <style>
        #_form_7_ {
          font-size: 14px;
          line-height: 1.6;
          font-family: arial, helvetica, sans-serif;
          margin: 0;
        }

        #_form_7_ * {
          outline: 0;
        }

        ._form_hide {
          display: none;
          visibility: hidden;
        }

        ._form_show {
          display: block;
          visibility: visible;
        }

        #_form_7_._form-top {
          top: 0;
        }

        #_form_7_._form-bottom {
          bottom: 0;
        }

        #_form_7_._form-left {
          left: 0;
        }

        #_form_7_._form-right {
          right: 0;
        }

        #_form_7_ input[type="text"],
        #_form_7_ input[type="tel"],
        #_form_7_ input[type="date"],
        #_form_7_ textarea {
          padding: 6px;
          height: auto;
          border: #979797 1px solid;
          border-radius: 4px;
          color: #000 !important;
          font-size: 14px;
          -webkit-box-sizing: border-box;
          -moz-box-sizing: border-box;
          box-sizing: border-box;
        }

        #_form_7_ textarea {
          resize: none;
        }

        #_form_7_ ._submit {
          /*-webkit-appearance: none;*/
          cursor: pointer;
          font-family: arial, sans-serif;
          font-size: 14px;
          text-align: center;
          background: #ffd700 !important;
          border: 8px solid #333333 !important;
          -moz-border-radius: 15px !important;
          -webkit-border-radius: 15px !important;
          border-radius: 15px !important;
          color: #000000 !important;
          padding: 12px !important;
        }

        #_form_7_ ._submit:disabled {
          cursor: not-allowed;
          opacity: 0.4;
        }

        #_form_7_ ._submit.processing {
          position: relative;
        }

        #_form_7_ ._submit.processing::before {
          content: "";
          width: 1em;
          height: 1em;
          position: absolute;
          z-index: 1;
          top: 50%;
          left: 50%;
          border: double 3px transparent;
          border-radius: 50%;
          background-image: linear-gradient(#ffd700, #ffd700),
            conic-gradient(#ffd700, #000000);
          background-origin: border-box;
          background-clip: content-box, border-box;
          animation: 1200ms ease 0s infinite normal none running _spin;
        }

        #_form_7_ ._submit.processing::after {
          content: "";
          position: absolute;
          top: 0;
          bottom: 0;
          left: 0;
          right: 0;
          background: #ffd700 !important;
          border: 8px solid #333333 !important;
          -moz-border-radius: 15px !important;
          -webkit-border-radius: 15px !important;
          border-radius: 15px !important;
          color: #000000 !important;
          padding: 12px !important;
        }

        @keyframes _spin {
          0% {
            transform: translate(-50%, -50%) rotate(90deg);
          }

          100% {
            transform: translate(-50%, -50%) rotate(450deg);
          }
        }

        #_form_7_ ._close-icon {
          cursor: pointer;
          background-image: url("https://d226aj4ao1t61q.cloudfront.net/esfkyjh1u_forms-close-dark.png");
          background-repeat: no-repeat;
          background-size: 14.2px 14.2px;
          position: absolute;
          display: block;
          top: 11px;
          right: 9px;
          overflow: hidden;
          width: 16.2px;
          height: 16.2px;
        }

        #_form_7_ ._close-icon:before {
          position: relative;
        }

        #_form_7_ ._form-body {
          margin-bottom: 30px;
        }

        #_form_7_ ._form-image-left {
          width: 150px;
          float: left;
        }

        #_form_7_ ._form-content-right {
          margin-left: 164px;
        }

        #_form_7_ ._form-branding {
          color: #fff;
          font-size: 10px;
          clear: both;
          text-align: left;
          margin-top: 30px;
          font-weight: 100;
        }

        #_form_7_ ._form-branding ._logo {
          display: block;
          width: 130px;
          height: 14px;
          margin-top: 6px;
          background-image: url("https://d226aj4ao1t61q.cloudfront.net/hh9ujqgv5_aclogo_li.png");
          background-size: 130px auto;
          background-repeat: no-repeat;
        }

        #_form_7_ .form-sr-only {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          border: 0;
        }

        #_form_7_ ._form-label,
        #_form_7_ ._form_element ._form-label {
          font-weight: bold;
          margin-bottom: 5px;
          display: block;
        }

        #_form_7_._dark ._form-branding {
          color: #333;
        }

        #_form_7_._dark ._form-branding ._logo {
          background-image: url("https://d226aj4ao1t61q.cloudfront.net/jftq2c8s_aclogo_dk.png");
        }

        #_form_7_ ._form_element {
          position: relative;
          margin-bottom: 10px;
          font-size: 0;
          max-width: 100%;
        }

        #_form_7_ ._form_element * {
          font-size: 14px;
        }

        #_form_7_ ._form_element._clear {
          clear: both;
          width: 100%;
          float: none;
        }

        #_form_7_ ._form_element._clear:after {
          clear: left;
        }

        #_form_7_ ._form_element input[type="text"],
        #_form_7_ ._form_element input[type="date"],
        #_form_7_ ._form_element select,
        #_form_7_ ._form_element textarea:not(.g-recaptcha-response) {
          display: block;
          width: 100%;
          -webkit-box-sizing: border-box;
          -moz-box-sizing: border-box;
          box-sizing: border-box;
          font-family: inherit;
        }

        #_form_7_ ._field-wrapper {
          position: relative;
        }

        #_form_7_ ._inline-style {
          float: left;
        }

        #_form_7_ ._inline-style input[type="text"] {
          width: 150px;
        }

        #_form_7_ ._inline-style:not(._clear) + ._inline-style:not(._clear) {
          margin-left: 20px;
        }

        #_form_7_ ._form_element img._form-image {
          max-width: 100%;
        }

        #_form_7_ ._form_element ._form-fieldset {
          border: 0;
          padding: 0.01em 0 0 0;
          margin: 0;
          min-width: 0;
        }

        #_form_7_ ._clear-element {
          clear: left;
        }

        #_form_7_ ._full_width {
          width: 100%;
        }

        #_form_7_ ._form_full_field {
          display: block;
          width: 100%;
          margin-bottom: 10px;
        }

        #_form_7_ input[type="text"]._has_error,
        #_form_7_ textarea._has_error {
          border: #f37c7b 1px solid;
        }

        #_form_7_ input[type="checkbox"]._has_error {
          outline: #f37c7b 1px solid;
        }

        #_form_7_ ._show_be_error {
          float: left;
        }

        #_form_7_ ._error {
          display: block;
          position: absolute;
          font-size: 14px;
          z-index: 10000001;
        }

        #_form_7_ ._error._above {
          padding-bottom: 4px;
          bottom: 39px;
          right: 0;
        }

        #_form_7_ ._error._below {
          padding-top: 8px;
          top: 100%;
          right: 0;
        }

        #_form_7_ ._error._above ._error-arrow {
          bottom: -4px;
          right: 15px;
          border-left: 8px solid transparent;
          border-right: 8px solid transparent;
          border-top: 8px solid #ffdddd;
        }

        #_form_7_ ._error._below ._error-arrow {
          top: 0;
          right: 15px;
          border-left: 8px solid transparent;
          border-right: 8px solid transparent;
          border-bottom: 8px solid #ffdddd;
        }

        #_form_7_ ._error-inner {
          padding: 12px 12px 12px 36px;
          background-color: #ffdddd;
          background-image: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8ZM9 3V9H7V3H9ZM9 13V11H7V13H9Z' fill='%23CA0000'/%3E%3C/svg%3E");
          background-repeat: no-repeat;
          background-position: 12px center;
          font-size: 14px;
          font-family: arial, sans-serif;
          font-weight: 600;
          line-height: 16px;
          color: #000;
          text-align: center;
          text-decoration: none;
          -webkit-border-radius: 4px;
          -moz-border-radius: 4px;
          border-radius: 4px;
          box-shadow: 0 1px 4px rgba(31, 33, 41, 0.298295);
        }

        @media only screen and (max-width: 319px) {
          #_form_7_ ._error-inner {
            padding: 7px 7px 7px 25px;
            font-size: 12px;
            line-height: 12px;
            background-position: 4px center;
            max-width: 100px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
          }
        }

        #_form_7_ ._error-inner._form_error {
          margin-bottom: 5px;
          text-align: left;
        }

        #_form_7_ ._button-wrapper ._error-inner._form_error {
          position: static;
        }

        #_form_7_ ._error-inner._no_arrow {
          margin-bottom: 10px;
        }

        #_form_7_ ._error-arrow {
          position: absolute;
          width: 0;
          height: 0;
        }

        #_form_7_ ._error-html {
          margin-bottom: 10px;
        }

        .pika-single {
          z-index: 10000001 !important;
        }

        #_form_7_ input[type="text"].datetime_date {
          width: 69%;
          display: inline;
        }

        #_form_7_ select.datetime_time {
          width: 29%;
          display: inline;
          height: 32px;
        }

        #_form_7_ input[type="date"].datetime_date {
          width: 69%;
          display: inline-flex;
        }

        #_form_7_ input[type="time"].datetime_time {
          width: 29%;
          display: inline-flex;
        }

        #_form_7_ .inline-form-content {
          max-width: 510px;
        }

        @media (min-width: 320px) and (max-width: 667px) {
          ::-webkit-scrollbar {
            display: none;
          }

          #_form_7_ {
            margin: 0;
            width: 100%;
            min-width: 100%;
            max-width: 100%;
            box-sizing: border-box;
          }

          #_form_7_ * {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            font-size: 1em;
          }

          #_form_7_ ._form-content {
            margin: 0;
            width: 100%;
          }

          #_form_7_ ._form-inner {
            display: block;
            min-width: 100%;
          }

          #_form_7_ ._form-title,
          #_form_7_ ._inline-style {
            margin-top: 0;
            margin-right: 0;
            margin-left: 0;
          }

          #_form_7_ ._form-title {
            font-size: 1.2em;
          }

          #_form_7_ ._form_element {
            margin: 0 0 20px;
            padding: 0;
            width: 100%;
          }

          #_form_7_ ._form-element,
          #_form_7_ ._inline-style,
          #_form_7_ input[type="text"],
          #_form_7_ label,
          #_form_7_ p,
          #_form_7_ textarea:not(.g-recaptcha-response) {
            float: none;
            display: block;
            width: 100%;
          }

          #_form_7_ ._row._checkbox-radio label {
            display: inline;
          }

          #_form_7_ ._row,
          #_form_7_ p,
          #_form_7_ label {
            margin-bottom: 0.7em;
            width: 100%;
          }

          #_form_7_ ._row input[type="checkbox"],
          #_form_7_ ._row input[type="radio"] {
            margin: 0 !important;
            vertical-align: middle !important;
          }

          #_form_7_ ._row input[type="checkbox"] + span label {
            display: inline;
          }

          #_form_7_ ._row span label {
            margin: 0 !important;
            width: initial !important;
            vertical-align: middle !important;
          }

          #_form_7_ ._form-image {
            max-width: 100%;
            height: auto !important;
          }

          #_form_7_ input[type="text"] {
            padding-left: 10px;
            padding-right: 10px;
            font-size: 16px;
            line-height: 1.3em;
            /*-webkit-appearance: none*/
          }

          #_form_7_ input[type="radio"],
          #_form_7_ input[type="checkbox"] {
            display: inline-block;
            width: 1.3em;
            height: 1.3em;
            font-size: 1em;
            margin: 0 0.3em 0 0;
            vertical-align: baseline;
          }

          #_form_7_ button[type="submit"] {
            padding: 20px;
            font-size: 1.5em;
          }

          #_form_7_ ._inline-style {
            margin: 20px 0 0 !important;
          }

          #_form_7_ ._inline-style input[type="text"] {
            width: 100%;
          }
        }

        #_form_7_ .sms_consent_checkbox {
          position: relative;
          width: 100%;
          display: flex;
          align-items: flex-start;
          padding: 20px 0;
        }

        #_form_7_ .sms_consent_checkbox input[type="checkbox"] {
          float: left;
          margin: 5px 10px 10px 0;
        }

        #_form_7_ .sms_consent_checkbox .sms_consent_message {
          display: inline;
          width: 95%;
          float: left;
          text-align: left;
          margin-bottom: 10px;
          font-size: 10px;
          color: #7d8799;
        }

        #_form_7_ .sms_consent_checkbox .sms_consent_message.sms_consent_mini {
          width: 90%;
        }

        #_form_7_ .sms_consent_checkbox ._error._above {
          right: auto;
          bottom: 0;
        }

        #_form_7_ .sms_consent_checkbox ._error._above ._error-arrow {
          right: auto;
          left: 5px;
        }

        @media (min-width: 320px) and (max-width: 667px) {
          #_form_7_ .sms_consent_checkbox ._error._above {
            top: -30px;
            left: 0;
            bottom: auto;
          }
        }

        #_form_7_ .field-required {
          color: #ff0000;
        }

        #_form_7_ {
          position: relative;
          text-align: left;
          margin: 25px auto 0;
          padding-top: 24px;
          padding-right: 24px;
          padding-bottom: 24px;
          padding-left: 24px;
          -webkit-box-sizing: border-box;
          -moz-box-sizing: border-box;
          box-sizing: border-box;
          background: black !important;
          border: 0;
          max-width: 680px;
          -moz-border-radius: 12px !important;
          -webkit-border-radius: 12px !important;
          border-radius: 12px !important;
          color: #000000;
        }

        #_form_7_ ._show_be_error {
          min-width: 100%;
        }

        #_form_7_._inline-form,
        #_form_7_._inline-form ._form-content {
          font-family: Cinzel Decorative;
          font-size: 14px;
          font-weight: 400;
        }

        #_form_7_._inline-form ._row span,
        #_form_7_._inline-form ._row label {
          font-family: Cinzel Decorative;
          font-size: 14px;
          font-weight: 400;
          line-height: 1.6em;
          color: gold !important;
        }

        #_form_7__inlineform input[type="text"],
        #_form_7__inlineform input[type="date"],
        #_form_7__inlineform input[type="tel"],
        #_form_7__inlineform select,
        #_form_7__inlineform textarea:not(.g-recaptcha-response) {
          font-family: Cinzel Decorative;
          font-size: 14px;
          font-weight: 400;
          color: #000000;
          line-height: 1.6em;
        }

        #_form_7_._inline-form ._html-code *:not(h1, h2, h3, h4, h5, h6),
        #_form_7_._inline-form .sms_consent_message,
        #_form_7_._inline-form ._form-thank-you {
          font-family: Cinzel Decorative;
          font-size: 14px;
          font-weight: 400;
          color: gold !important;
        }

        #_form_7_._inline-form ._form-label,
        #_form_7_._inline-form ._form-emailidentifier,
        #_form_7_._inline-form ._form-checkbox-option-label {
          font-family: Cinzel Decorative;
          font-size: 14px;
          font-weight: 700;
          line-height: 1.6em;
          color: gold !important;
        }

        #_form_7_._inline-form ._submit {
          margin-top: 12px;
          font-family: Cinzel Decorative;
          font-size: 14px;
          font-weight: 400;
        }

        #_form_7_._inline-form ._html-code h1,
        #_form_7_._inline-form ._html-code h2,
        #_form_7_._inline-form ._html-code h3,
        #_form_7_._inline-form ._html-code h4,
        #_form_7_._inline-form ._html-code h5,
        #_form_7_._inline-form ._html-code h6,
        #_form_7_._inline-form ._form-title {
          text-align: center;
          font-family: Cinzel Decorative, cursive;
          font-size: 24px;
          line-height: normal;
          font-weight: 700;
          color: gold;
          margin-bottom: 0;
          display: block;
        }

        #_form_7_._inline-form ._form-branding {
          font-family: "IBM Plex Sans", Helvetica, sans-serif;
          font-size: 13px;
          font-weight: 100;
          font-style: normal;
          text-decoration: none;
        }

        #_form_7_:before,
        #_form_7_:after {
          content: " ";
          display: table;
        }

        #_form_7_:after {
          clear: both;
        }

        #_form_7_._inline-style {
          width: auto;
          display: inline-block;
        }

        #_form_7_._inline-style input[type="text"],
        #_form_7_._inline-style input[type="date"] {
          padding: 10px 12px;
        }

        #_form_7_._inline-style button._inline-style {
          position: relative;
          top: 27px;
        }

        #_form_7_._inline-style p {
          margin: 0;
        }

        #_form_7_._inline-style ._button-wrapper {
          position: relative;
          margin: 16px 12.5px 0 20px;
        }

        #_form_7_ ._form-thank-you {
          position: relative;
          left: 0;
          right: 0;
          text-align: center;
          font-size: 18px;
        }

        #_form_7_ ._form-pc-confirmation ._submit {
          margin-top: 16px;
        }

        @media (min-width: 320px) and (max-width: 667px) {
          #_form_7_._inline-form._inline-style ._inline-style._button-wrapper {
            margin-top: 20px !important;
            margin-left: 0 !important;
          }
        }

        #_form_7_ .iti {
          width: 100%;
        }

        #_form_7_ .iti.iti--allow-dropdown.iti--separate-dial-code {
          width: 100%;
        }

        #_form_7_ .iti input {
          width: 100%;
          border: #979797 1px solid;
          border-radius: 4px;
        }

        #_form_7_ .iti--separate-dial-code .iti__selected-flag {
          background-color: #ffffff;
          border-radius: 4px;
        }

        #_form_7_ .iti--separate-dial-code .iti__selected-flag:hover {
          background-color: rgba(0, 0, 0, 0.05);
        }

        #_form_7_ .iti__country-list {
          border-radius: 4px;
          margin-top: 4px;
          min-width: 460px;
        }

        #_form_7_ .iti__country-list--dropup {
          margin-bottom: 4px;
        }

        #_form_7_ .phone-error-hidden {
          display: none;
        }

        #_form_7_ .phone-error {
          color: #e40e49;
        }

        #_form_7_ .phone-input-error {
          border: 1px solid #e40e49 !important;
        }

        #_form_7_._inline-form
          ._form-content
          ._form-list-subscriptions-field
          fieldset {
          margin: 0;
          margin-bottom: 1.1428571429em;
          border: none;
          padding: 0;
        }

        #_form_7_._inline-form
          ._form-content
          ._form-list-subscriptions-field
          fieldset:last-child {
          margin-bottom: 0;
        }

        #_form_7_._inline-form
          ._form-content
          ._form-list-subscriptions-field
          legend {
          margin-bottom: 1.1428571429em;
        }

        #_form_7_._inline-form
          ._form-content
          ._form-list-subscriptions-field
          label {
          display: flex;
          align-items: flex-start;
          justify-content: flex-start;
          margin-bottom: 0.8571428571em;
        }

        #_form_7_._inline-form
          ._form-content
          ._form-list-subscriptions-field
          label:last-child {
          margin-bottom: 0;
        }

        #_form_7_._inline-form
          ._form-content
          ._form-list-subscriptions-field
          input {
          margin: 0;
          margin-right: 8px;
        }

        #_form_7_._inline-form
          ._form-content
          ._form-list-subscriptions-field
          ._form-checkbox-option-label {
          display: block;
          font-weight: 400;
          margin-top: -4px;
        }

        #_form_7_._inline-form
          ._form-content
          ._form-list-subscriptions-field
          ._form-checkbox-option-label-with-description {
          display: block;
          font-weight: 700;
          margin-top: -4px;
        }

        #_form_7_._inline-form
          ._form-content
          ._form-list-subscriptions-field
          ._form-checkbox-option-description {
          margin: 0;
          font-size: 0.8571428571em;
        }

        #_form_7_._inline-form
          ._form-content
          ._form-list-subscriptions-field
          ._form-subscriptions-unsubscribe-all-description {
          line-height: normal;
          margin-top: -2px;
        }

        #_form_7_ ._button-wrapper {
          text-align: center;
        }

        #_form_7_ {
          background-color: #000 !important;
          border-radius: 18px !important;
          padding: 28px;
          max-width: 600px;
          margin: 40px auto;
          color: gold;
          font-family: "Cinzel Decorative", cursive;
          /*box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);*/
        }

        #_form_7_ ._form-label,
        #_form_7_ ._form-title,
        #_form_7_ ._form_element p,
        #_form_7_ ._submit {
          color: gold !important;
          font-family: "Cinzel Decorative", cursive;
        }

        #_form_7_ input[type="text"] {
          border-radius: 8px;
          border: 1px solid #999;
          padding: 10px;
          width: 100%;
          margin-bottom: 10px;
          font-size: 16px;
          box-shadow: 0 0 8px rgba(255, 215, 0, 0.15);
          transition: box-shadow 0.3s ease, border-color 0.3s ease;
        }

        #_form_7_ input[type="text"]:focus {
          outline: none;
          box-shadow: 0 0 12px rgba(255, 215, 0, 0.35);
          border-color: #ffd700;
        }

        #_form_7_ ._submit {
          background-color: #ffd700 !important;
          border: 3px solid #333 !important;
          border-radius: 12px !important;
          color: #000 !important;
          padding: 14px 24px !important;
          font-size: 16px;
          margin-top: 16px;
          cursor: pointer;
          transition: all 0.3s ease;
        }

        #_form_7_ ._submit:hover {
          background-color: #fff200 !important;
          box-shadow: 0 0 10px #ffd700;
        }

        #_form_7_ ._form-branding {
          display: none;
        }

        #_form_7_._inline-form ._html-code p {
          font-family: "Playfair Display", serif !important;
          font-size: 1.1rem !important;
          color: #fef6e2 !important;
          margin-bottom: 1.5rem !important;
          line-height: 1.6 !important;
          text-align: center;
        }

        #_form_7_ ._button-wrapper {
          text-align: center;
        }

        #formSection .customSubmitBtn {
          margin-top: 2.5rem;
          /* Puedes ajustar a 3rem o más si lo deseas */
        }

        .field-error {
          color: #f7c28b;
          font-size: 0.9rem;
          font-style: italic;
          margin-top: 4px;
          margin-bottom: 8px;
          text-shadow: 0 0 6px rgba(255, 215, 150, 0.2);
        }

        .btn-focus-glow {
          animation: pulseFocus 1.6s ease-in-out 1;
        }

        @keyframes pulseFocus {
          0% {
            box-shadow: 0 0 10px gold;
          }

          50% {
            box-shadow: 0 0 25px gold;
          }

          100% {
            box-shadow: 0 0 10px gold;
          }
        }

        #_form_7_ input[type="text"],
        #_form_7_ input[type="email"],
        #_form_7_ input[type="submit"] {
          width: 100% !important;
          padding: 0.9rem 1.2rem !important;
          border: 1px solid gold !important;
          border-radius: 12px !important;
          font-size: 1rem !important;
          background: #111 !important;
          color: #ffd700 !important;
          font-family: "Playfair Display", serif !important;
          box-shadow: 0 0 10px rgba(255, 215, 0, 0.3) !important;
        }

        #_form_7_ input::placeholder {
          color: #ffd70099 !important;
          font-style: italic !important;
        }
      </style>

      <form
        method="POST"
        action="https://omnipresence24824.activehosted.com/proc.php"
        id="_form_7_"
        class="_form _form_7 _inline-form"
        novalidate
        data-styles-version="5"
      >
        <input type="hidden" name="u" value="7" />
        <input type="hidden" name="f" value="7" />
        <input type="hidden" name="s" />
        <input type="hidden" name="c" value="0" />
        <input type="hidden" name="m" value="0" />
        <input type="hidden" name="act" value="sub" />
        <input type="hidden" name="v" value="2" />
        <input
          type="hidden"
          name="or"
          value="6ab2f37771a4f018a7df2043552c073e"
        />
        <div class="_form-content">
          <div class="_form_element _x75884670 _full_width _clear">
            <title class="_form-title">
              RECEIVE THE KEYS TO ACTIVATE YOUR INNER WISDOM
            </title>
          </div>
          <div class="_form_element _x82082208 _full_width _clear">
            <div class="_html-code">
              <p>Receive the secret keys that will awaken your inner wisdom.</p>
            </div>
          </div>
          <div class="_form_element _x43483084 _full_width">
            <label for="fullname" class="_form-label"> Your Sacred Name </label>

            <div class="_field-wrapper">
              <input
                type="text"
                id="fullname"
                name="fullname"
                placeholder=" Your Sacred Name..."
                required
                style="
                  width: 100% !important;
                  padding: 0.9rem 1.2rem !important;
                  border: 1px solid gold !important;
                  border-radius: 12px !important;
                  font-size: 1rem !important;
                  background: #111 !important;
                  color: #ffd700 !important;
                  font-family: 'Playfair Display', serif !important;
                  box-shadow: 0 0 10px rgba(255, 215, 0, 0.3) !important;
                "
              />
            </div>
          </div>
          <div class="_form_element _x34758650 _full_width">
            <label for="email" class="_form-label">
              Your divine channel (email)<span class="field-required"> * </span>
            </label>
            <div class="_field-wrapper">
              <input
                type="text"
                id="email"
                name="email"
                placeholder="Your divine channel (email)"
                required
                style="
                  width: 100% !important;
                  padding: 0.9rem 1.2rem !important;
                  border: 1px solid gold !important;
                  border-radius: 12px !important;
                  font-size: 1rem !important;
                  background: #111 !important;
                  color: #ffd700 !important;
                  font-family: 'Playfair Display', serif !important;
                  box-shadow: 0 0 10px rgba(255, 215, 0, 0.3) !important;
                "
              />
            </div>
          </div>
          <div class="_button-wrapper _full_width" style="text-align: center">
            <button
              type="button"
              id="customSubmitBtn"
              class="btn-continue active"
            >
              ✨ RECEIVE MY GUIDE
            </button>
          </div>
          <div class="_button-wrapper _full_width" style="display: none">
            <button id="_form_7_submit" class="_submit" type="submit">
              RECEIVE MY GUIDE
            </button>
          </div>
          <div class="_clear-element"></div>
        </div>
        <div class="_form-thank-you" style="display: none"></div>
        <div class="_form-branding">
          <div class="_marketing-by">Marketing by</div>
          <a
            href="https://www.activecampaign.com/?utm_medium=referral&utm_campaign=acforms"
            class="_logo"
          >
            <span class="form-sr-only"> ActiveCampaign </span>
          </a>
        </div>
      </form>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(() => {
          const legalNotice = document.getElementById("legalNotice");
          if (legalNotice) {
            legalNotice.style.opacity = "1";
            legalNotice.style.transform = "translateY(0)";
          }
        }, 1000);

        const customBtn = document.getElementById("customSubmitBtn");
        if (!customBtn) {
          console.warn(
            "❌ No se encontró el botón personalizado (#customSubmitBtn)"
          );
          return;
        }

        const waitForRealButton = setInterval(() => {
          const realSubmit = document.querySelector("#_form_7_submit");
          if (realSubmit) {
            clearInterval(waitForRealButton);

            customBtn.disabled = false;
            customBtn.addEventListener("click", async () => {
              try {
                guardarCartasSeleccionadasEnLocalStorage();
                guardarIntencionSeleccionadaEnLocalStorage();
              } catch (err) {
                console.error(
                  "❌ Error guardando en localStorage:",
                  err.message
                );
              }

              // 🔍 Capturar datos
              const correo = document.getElementById("email").value.trim();
              const nombre = document.getElementById("fullname").value.trim();
              const intencion = localStorage.getItem("code_intent_codex");
              const fragmentosSeleccionados =
                JSON.parse(localStorage.getItem("selected_portal_codex")) || [];

              // 🔒 Validaciones locales
              const isValidEmail = (correo) =>
                /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(correo);
              const isValidName = (nombre) =>
                typeof nombre === "string" && nombre.length > 1;

              if (!isValidEmail(correo)) {
                alert("Please enter a valid email address.");
                return;
              }

              if (!isValidName(nombre)) {
                alert("Please enter a valid name.");
                return;
              }

              if (!intencion || fragmentosSeleccionados.length !== 5) {
                alert("Missing data to complete the registration.");
                return;
              }
              try {
                const fragmentosData = fragmentosSeleccionados.map(
                  (id, index) => ({
                    posicion: Number(index + 1),
                    id_fragmento: Number(id),
                  })
                );
                document.getElementById("overlay-loader").style.display =
                  "flex";
                const registrarResp = await fetch(
                  "https://api.omnipresence.me/api/registrar-sesion-portal",
                  {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                      correo,
                      nombre,
                      intencion,
                      fragmentos: fragmentosData,
                      authKey: "G7!vP2#xQ9$zR4@tN1&kM3*eL6",
                      lang: "en",
                    }),
                  }
                );

                const data = await registrarResp.json();

                if (!registrarResp.ok || !data.id_usuario || !data.id_sesion) {
                  throw new Error("Fallo en el registro");
                }

                localStorage.setItem("id_usuario_codex", data.id_usuario);
                localStorage.setItem("id_sesion_codex", data.id_sesion);

                // 🚀 Activar validaciones de AC y submit real
                realSubmit.click();
                document.getElementById("overlay-loader").style.display =
                  "none";
              } catch (error) {
                console.error(
                  "❌ Error registering session in backend:",
                  error.message
                );
                document.getElementById("overlay-loader").style.display =
                  "none";
                alert("An error occurred while registering your information.");
              }
            });
          } else {
            console.log("⏳ Waiting for the real AC button to appear...");
          }
        }, 100);
      });

      window.cfields = [];
      window._show_thank_you = function (id, message, trackcmp_url, email) {
        var form = document.getElementById("_form_" + id + "_"),
          thank_you = form.querySelector("._form-thank-you");
        form.querySelector("._form-content").style.display = "none";
        thank_you.innerHTML = message;
        thank_you.style.display = "block";
        const vgoAlias =
          typeof visitorGlobalObjectAlias === "undefined"
            ? "vgo"
            : visitorGlobalObjectAlias;
        var visitorObject = window[vgoAlias];
        if (email && typeof visitorObject !== "undefined") {
          visitorObject("setEmail", email);
          visitorObject("update");
        } else if (typeof trackcmp_url != "undefined" && trackcmp_url) {
          // Site tracking URL to use after inline form submission.
          _load_script(trackcmp_url);
        }
        if (typeof window._form_callback !== "undefined")
          window._form_callback(id);
      };
      window._show_unsubscribe = function (id, message, trackcmp_url, email) {
        var form = document.getElementById("_form_" + id + "_"),
          unsub = form.querySelector("._form-thank-you");
        var branding = form.querySelector("._form-branding");
        if (branding) {
          branding.style.display = "none";
        }
        form.querySelector("._form-content").style.display = "none";
        unsub.style.display = "block";
        form.insertAdjacentHTML("afterend", message);
        const vgoAlias =
          typeof visitorGlobalObjectAlias === "undefined"
            ? "vgo"
            : visitorGlobalObjectAlias;
        var visitorObject = window[vgoAlias];
        if (email && typeof visitorObject !== "undefined") {
          visitorObject("setEmail", email);
          visitorObject("update");
        } else if (typeof trackcmp_url != "undefined" && trackcmp_url) {
          // Site tracking URL to use after inline form submission.
          _load_script(trackcmp_url);
        }
        if (typeof window._form_callback !== "undefined")
          window._form_callback(id);
      };
      window._show_error = function (id, message, html) {
        var form = document.getElementById("_form_" + id + "_"),
          err = document.createElement("div"),
          button = form.querySelector('button[type="submit"]'),
          old_error = form.querySelector("._form_error");
        if (old_error) old_error.parentNode.removeChild(old_error);
        err.innerHTML = message;
        err.className = "_error-inner _form_error _no_arrow";
        var wrapper = document.createElement("div");
        wrapper.className = "_form-inner _show_be_error";
        wrapper.appendChild(err);
        button.parentNode.insertBefore(wrapper, button);
        var submitButton = form.querySelector('[id^="_form"][id$="_submit"]');
        submitButton.disabled = false;
        submitButton.classList.remove("processing");
        if (html) {
          var div = document.createElement("div");
          div.className = "_error-html";
          div.innerHTML = html;
          err.appendChild(div);
        }
      };
      window._show_pc_confirmation = function (
        id,
        header,
        detail,
        show,
        email
      ) {
        var form = document.getElementById("_form_" + id + "_"),
          pc_confirmation = form.querySelector("._form-pc-confirmation");
        if (pc_confirmation.style.display === "none") {
          form.querySelector("._form-content").style.display = "none";
          pc_confirmation.innerHTML =
            "<div class='_form-title'>" +
            header +
            "</div>" +
            "<p>" +
            detail +
            "</p>" +
            "<button class='_submit' id='hideButton'>Manage preferences</button>";
          pc_confirmation.style.display = "block";
          var mp = document.querySelector('input[name="mp"]');
          mp.value = "0";
        } else {
          form.querySelector("._form-content").style.display = "inline";
          pc_confirmation.style.display = "none";
        }

        var hideButton = document.getElementById("hideButton");
        // Add event listener to the button
        hideButton.addEventListener("click", function () {
          var submitButton = document.querySelector("#_form_7_submit");
          submitButton.disabled = false;
          submitButton.classList.remove("processing");
          var mp = document.querySelector('input[name="mp"]');
          mp.value = "1";
          const cacheBuster = new URL(window.location.href);
          cacheBuster.searchParams.set("v", new Date().getTime());
          window.location.href = cacheBuster.toString();
        });

        const vgoAlias =
          typeof visitorGlobalObjectAlias === "undefined"
            ? "vgo"
            : visitorGlobalObjectAlias;
        var visitorObject = window[vgoAlias];
        if (email && typeof visitorObject !== "undefined") {
          visitorObject("setEmail", email);
          visitorObject("update");
        } else if (typeof trackcmp_url != "undefined" && trackcmp_url) {
          // Site tracking URL to use after inline form submission.
          _load_script(trackcmp_url);
        }
        if (typeof window._form_callback !== "undefined")
          window._form_callback(id);
      };
      window._load_script = function (url, callback, isSubmit) {
        var head = document.querySelector("head"),
          script = document.createElement("script"),
          r = false;
        var submitButton = document.querySelector("#_form_7_submit");
        script.charset = "utf-8";
        script.src = url;
        if (callback) {
          script.onload = script.onreadystatechange = function () {
            if (!r && (!this.readyState || this.readyState == "complete")) {
              r = true;
              callback();
            }
          };
        }
        script.onerror = function () {
          if (isSubmit) {
            if (script.src.length > 10000) {
              _show_error(
                "7",
                "Sorry, your submission failed. Please shorten your responses and try again."
              );
            } else {
              _show_error(
                "7",
                "Sorry, your submission failed. Please try again."
              );
            }
            submitButton.disabled = false;
            submitButton.classList.remove("processing");
          }
        };

        head.appendChild(script);
      };
      (function () {
        var iti;
        if (window.location.search.search("excludeform") !== -1) return false;
        var getCookie = function (name) {
          var match = document.cookie.match(
            new RegExp("(^|; )" + name + "=([^;]+)")
          );
          return match ? match[2] : null;
        };
        var setCookie = function (name, value) {
          var now = new Date();
          var time = now.getTime();
          var expireTime = time + 1000 * 60 * 60 * 24 * 365;
          now.setTime(expireTime);
          document.cookie =
            name +
            "=" +
            value +
            "; expires=" +
            now +
            ";path=/; Secure; SameSite=Lax;";
        };
        var addEvent = function (element, event, func) {
          if (element.addEventListener) {
            element.addEventListener(event, func);
          } else {
            var oldFunc = element["on" + event];
            element["on" + event] = function () {
              oldFunc.apply(this, arguments);
              func.apply(this, arguments);
            };
          }
        };
        var _removed = false;
        var form_to_submit = document.getElementById("_form_7_");
        var allInputs = form_to_submit.querySelectorAll(
            "input, select, textarea"
          ),
          tooltips = [],
          submitted = false;

        var getUrlParam = function (name) {
          if (name.toLowerCase() !== "email") {
            var params = new URLSearchParams(window.location.search);
            return params.get(name) || false;
          }
          // email is a special case because a plus is valid in the email address
          var qString = window.location.search;
          if (!qString) {
            return false;
          }
          var parameters = qString.substr(1).split("&");
          for (var i = 0; i < parameters.length; i++) {
            var parameter = parameters[i].split("=");
            if (parameter[0].toLowerCase() === "email") {
              return decodeURIComponent(parameter[1] || "");
            }
          }
          return false;
        };

        var acctDateFormat = "%m/%d/%Y";
        var getNormalizedDate = function (date, acctFormat) {
          var decodedDate = decodeURIComponent(date);
          if (acctFormat && acctFormat.match(/(%d|%e).*%m/gi) !== null) {
            return decodedDate.replace(
              /(\d{2}).*(\d{2}).*(\d{4})/g,
              "$3-$2-$1"
            );
          } else if (Date.parse(decodedDate)) {
            var dateObj = new Date(decodedDate);
            var year = dateObj.getFullYear();
            var month = dateObj.getMonth() + 1;
            var day = dateObj.getDate();
            return `${year}-${month < 10 ? `0${month}` : month}-${
              day < 10 ? `0${day}` : day
            }`;
          }
          return false;
        };

        var getNormalizedTime = function (time) {
          var hour, minutes;
          var decodedTime = decodeURIComponent(time);
          var timeParts = Array.from(
            decodedTime.matchAll(/(\d{1,2}):(\d{1,2})\W*([AaPp][Mm])?/gm)
          )[0];
          if (timeParts[3]) {
            // 12 hour format
            var isPM = timeParts[3].toLowerCase() === "pm";
            if (isPM) {
              hour =
                parseInt(timeParts[1]) === 12
                  ? "12"
                  : `${parseInt(timeParts[1]) + 12}`;
            } else {
              hour = parseInt(timeParts[1]) === 12 ? "0" : timeParts[1];
            }
          } else {
            // 24 hour format
            hour = timeParts[1];
          }
          var normalizedHour =
            parseInt(hour) < 10 ? `0${parseInt(hour)}` : hour;
          var minutes = timeParts[2];
          return `${normalizedHour}:${minutes}`;
        };

        for (var i = 0; i < allInputs.length; i++) {
          var regexStr = "field\\[(\\d+)\\]";
          var regex = new RegExp(regexStr);
          var results = regex.exec(allInputs[i].name);

          if (results !== null) {
            allInputs[i].dataset.name = allInputs[i].name.match(/\[time\]$/)
              ? `${window.cfields[results[1]]}_time`
              : window.cfields[results[1]];
          } else {
            allInputs[i].dataset.name = allInputs[i].name;
          }
          var fieldVal = getUrlParam(allInputs[i].dataset.name);

          if (fieldVal) {
            if (allInputs[i].dataset.autofill === "false") {
              continue;
            }
            if (
              allInputs[i].type == "radio" ||
              allInputs[i].type == "checkbox"
            ) {
              if (allInputs[i].value == fieldVal) {
                allInputs[i].checked = true;
              }
            } else if (allInputs[i].type == "date") {
              allInputs[i].value = getNormalizedDate(fieldVal, acctDateFormat);
            } else if (allInputs[i].type == "time") {
              allInputs[i].value = getNormalizedTime(fieldVal);
            } else {
              allInputs[i].value = fieldVal;
            }
          }
        }

        var remove_tooltips = function () {
          for (var i = 0; i < tooltips.length; i++) {
            tooltips[i].tip.parentNode.removeChild(tooltips[i].tip);
          }
          tooltips = [];
        };
        var remove_tooltip = function (elem) {
          for (var i = 0; i < tooltips.length; i++) {
            if (tooltips[i].elem === elem) {
              tooltips[i].tip.parentNode.removeChild(tooltips[i].tip);
              tooltips.splice(i, 1);
              return;
            }
          }
        };
        var create_tooltip = function (elem, text) {
          var tooltip = document.createElement("div"),
            arrow = document.createElement("div"),
            inner = document.createElement("div"),
            new_tooltip = {};
          if (
            elem.type != "radio" &&
            (elem.type != "checkbox" || elem.name === "sms_consent")
          ) {
            tooltip.className = "_error";
            arrow.className = "_error-arrow";
            inner.className = "_error-inner";
            inner.innerHTML = text;
            tooltip.appendChild(arrow);
            tooltip.appendChild(inner);
            elem.parentNode.appendChild(tooltip);
          } else {
            tooltip.className = "_error-inner _no_arrow";
            tooltip.innerHTML = text;
            elem.parentNode.insertBefore(tooltip, elem);
            new_tooltip.no_arrow = true;
          }
          new_tooltip.tip = tooltip;
          new_tooltip.elem = elem;
          tooltips.push(new_tooltip);
          return new_tooltip;
        };
        var resize_tooltip = function (tooltip) {
          var rect = tooltip.elem.getBoundingClientRect();
          var doc = document.documentElement,
            scrollPosition =
              rect.top -
              ((window.pageYOffset || doc.scrollTop) - (doc.clientTop || 0));
          if (scrollPosition < 40) {
            tooltip.tip.className =
              tooltip.tip.className.replace(/ ?(_above|_below) ?/g, "") +
              " _below";
          } else {
            tooltip.tip.className =
              tooltip.tip.className.replace(/ ?(_above|_below) ?/g, "") +
              " _above";
          }
        };
        var resize_tooltips = function () {
          if (_removed) return;
          for (var i = 0; i < tooltips.length; i++) {
            if (!tooltips[i].no_arrow) resize_tooltip(tooltips[i]);
          }
        };
        var validate_field = function (elem, remove) {
          var tooltip = null,
            value = elem.value,
            no_error = true;
          remove ? remove_tooltip(elem) : false;
          if (elem.type != "checkbox")
            elem.className = elem.className.replace(/ ?_has_error ?/g, "");
          if (elem.getAttribute("required") !== null) {
            if (
              elem.type == "radio" ||
              (elem.type == "checkbox" && /any/.test(elem.className))
            ) {
              var elems = form_to_submit.elements[elem.name];
              if (
                !(
                  elems instanceof NodeList || elems instanceof HTMLCollection
                ) ||
                elems.length <= 1
              ) {
                no_error = elem.checked;
              } else {
                no_error = false;
                for (var i = 0; i < elems.length; i++) {
                  if (elems[i].checked) no_error = true;
                }
              }
              if (!no_error) {
                tooltip = create_tooltip(elem, "Please select an option.");
              }
            } else if (elem.type == "checkbox") {
              var elems = form_to_submit.elements[elem.name],
                found = false,
                err = [];
              no_error = true;
              for (var i = 0; i < elems.length; i++) {
                if (elems[i].getAttribute("required") === null) continue;
                if (!found && elems[i] !== elem) return true;
                found = true;
                elems[i].className = elems[i].className.replace(
                  / ?_has_error ?/g,
                  ""
                );
                if (!elems[i].checked) {
                  no_error = false;
                  elems[i].className = elems[i].className + " _has_error";
                  err.push(
                    "Checking %s is required".replace("%s", elems[i].value)
                  );
                }
              }
              if (!no_error) {
                tooltip = create_tooltip(elem, err.join("<br/>"));
              }
            } else if (elem.tagName == "SELECT") {
              var selected = true;
              if (elem.multiple) {
                selected = false;
                for (var i = 0; i < elem.options.length; i++) {
                  if (elem.options[i].selected) {
                    selected = true;
                    break;
                  }
                }
              } else {
                for (var i = 0; i < elem.options.length; i++) {
                  if (
                    elem.options[i].selected &&
                    (!elem.options[i].value ||
                      elem.options[i].value.match(/\n/g))
                  ) {
                    selected = false;
                  }
                }
              }
              if (!selected) {
                elem.className = elem.className + " _has_error";
                no_error = false;
                tooltip = create_tooltip(elem, "Please select an option.");
              }
            } else if (value === null || value === "") {
              elem.className = elem.className + " _has_error";
              no_error = false;
              tooltip = create_tooltip(elem, "This field is required.");
            }
          }
          if (no_error && elem.name == "email") {
            if (
              !value.match(
                /^[\+_a-z0-9-'&=]+(\.[\+_a-z0-9-']+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,})$/i
              )
            ) {
              elem.className = elem.className + " _has_error";
              no_error = false;
              tooltip = create_tooltip(elem, "Enter a valid email address.");
            }
          }
          if (no_error && elem.id == "phone") {
            if (
              elem.value.trim() &&
              typeof iti != "undefined" &&
              !iti.isValidNumber()
            ) {
              elem.className = elem.className + " _has_error";
              no_error = false;
              tooltip = create_tooltip(elem, "Enter a valid phone number.");
            }
          }
          if (no_error && /date_field/.test(elem.className)) {
            if (!value.match(/^\d\d\d\d-\d\d-\d\d$/)) {
              elem.className = elem.className + " _has_error";
              no_error = false;
              tooltip = create_tooltip(elem, "Enter a valid date.");
            }
          }

          if (no_error && elem.name === "sms_consent") {
            const elemShouldBeChecked =
              !!elem.attributes.required && !elem.checked;
            if (elemShouldBeChecked) {
              elem.className = elem.className + " _has_error";
              no_error = false;
              tooltip = create_tooltip(
                elem,
                "Please check this box to continue"
              );
            } else {
              elem.className = elem.className.replace(/ ?_has_error ?/g, "");
            }
          }
          tooltip ? resize_tooltip(tooltip) : false;
          return no_error;
        };
        var needs_validate = function (el) {
          if (el.getAttribute("required") !== null) {
            return true;
          }
          if ((el.name === "email" || el.id === "phone") && el.value !== "") {
            return true;
          }

          return false;
        };
        var validate_form = function (e) {
          var err = form_to_submit.querySelector("._form_error"),
            no_error = true;
          if (!submitted) {
            submitted = true;
            for (var i = 0, len = allInputs.length; i < len; i++) {
              var input = allInputs[i];
              if (needs_validate(input)) {
                if (
                  input.type == "text" ||
                  input.type == "number" ||
                  input.type == "time" ||
                  input.type == "tel"
                ) {
                  addEvent(input, "blur", function () {
                    this.value = this.value.trim();
                    validate_field(this, true);
                  });
                  addEvent(input, "input", function () {
                    validate_field(this, true);
                  });
                } else if (input.type == "radio" || input.type == "checkbox") {
                  (function (el) {
                    function getElementsArray(name) {
                      const value = form_to_submit.elements[name];
                      if (Array.isArray(value)) {
                        return value;
                      }
                      return [value];
                    }
                    var radios = getElementsArray(el.name);
                    for (var i = 0; i < radios.length; i++) {
                      addEvent(radios[i], "change", function () {
                        validate_field(el, true);
                      });
                    }
                  })(input);
                } else if (input.tagName == "SELECT") {
                  addEvent(input, "change", function () {
                    validate_field(this, true);
                  });
                } else if (input.type == "textarea") {
                  addEvent(input, "input", function () {
                    validate_field(this, true);
                  });
                }
              }
            }
          }
          remove_tooltips();
          for (var i = 0, len = allInputs.length; i < len; i++) {
            var elem = allInputs[i];
            if (needs_validate(elem)) {
              if (elem.tagName.toLowerCase() !== "select") {
                elem.value = elem.value.trim();
              }
              validate_field(elem) ? true : (no_error = false);
            }
          }
          if (!no_error && e) {
            e.preventDefault();
          }
          resize_tooltips();
          return no_error;
        };
        addEvent(window, "resize", resize_tooltips);
        addEvent(window, "scroll", resize_tooltips);

        var _form_serialize = function (form) {
          if (!form || form.nodeName !== "FORM") {
            return;
          }
          var i,
            j,
            q = [];
          for (i = 0; i < form.elements.length; i++) {
            if (form.elements[i].name === "") {
              continue;
            }
            switch (form.elements[i].nodeName) {
              case "INPUT":
                switch (form.elements[i].type) {
                  case "tel":
                    q.push(
                      form.elements[i].name +
                        "=" +
                        encodeURIComponent(
                          form.elements[i].previousSibling.querySelector(
                            "div.iti__selected-dial-code"
                          ).innerText
                        ) +
                        encodeURIComponent(" ") +
                        encodeURIComponent(form.elements[i].value)
                    );
                    break;
                  case "text":
                  case "number":
                  case "date":
                  case "time":
                  case "hidden":
                  case "password":
                  case "button":
                  case "reset":
                  case "submit":
                    q.push(
                      form.elements[i].name +
                        "=" +
                        encodeURIComponent(form.elements[i].value)
                    );
                    break;
                  case "checkbox":
                  case "radio":
                    if (form.elements[i].checked) {
                      q.push(
                        form.elements[i].name +
                          "=" +
                          encodeURIComponent(form.elements[i].value)
                      );
                    }
                    break;
                  case "file":
                    break;
                }
                break;
              case "TEXTAREA":
                q.push(
                  form.elements[i].name +
                    "=" +
                    encodeURIComponent(form.elements[i].value)
                );
                break;
              case "SELECT":
                switch (form.elements[i].type) {
                  case "select-one":
                    q.push(
                      form.elements[i].name +
                        "=" +
                        encodeURIComponent(form.elements[i].value)
                    );
                    break;
                  case "select-multiple":
                    for (j = 0; j < form.elements[i].options.length; j++) {
                      if (form.elements[i].options[j].selected) {
                        q.push(
                          form.elements[i].name +
                            "=" +
                            encodeURIComponent(
                              form.elements[i].options[j].value
                            )
                        );
                      }
                    }
                    break;
                }
                break;
              case "BUTTON":
                switch (form.elements[i].type) {
                  case "reset":
                  case "submit":
                  case "button":
                    q.push(
                      form.elements[i].name +
                        "=" +
                        encodeURIComponent(form.elements[i].value)
                    );
                    break;
                }
                break;
            }
          }
          return q.join("&");
        };

        const formSupportsPost = false;
        var form_submit = function (e) {
          e.preventDefault();
          if (validate_form()) {
            if (
              form_to_submit.querySelector('input[name="phone"]') &&
              typeof iti != "undefined"
            ) {
              form_to_submit.querySelector('input[name="phone"]').value =
                iti.getNumber();
            }
            // use this trick to get the submit button & disable it using plain javascript
            var submitButton = e.target.querySelector("#_form_7_submit");
            submitButton.disabled = true;
            submitButton.classList.add("processing");
            var serialized = _form_serialize(
              document.getElementById("_form_7_")
            ).replace(/%0A/g, "\\n");
            var err = form_to_submit.querySelector("._form_error");
            err ? err.parentNode.removeChild(err) : false;
            async function submitForm() {
              var formData = new FormData();
              const searchParams = new URLSearchParams(serialized);
              searchParams.forEach((value, key) => {
                if (key !== "hideButton") {
                  formData.append(key, value);
                }
              });
              let request = {
                headers: {
                  Accept: "application/json",
                },
                body: formData,
                method: "POST",
              };

              let pageUrlParams = new URLSearchParams(window.location.search);
              if (pageUrlParams.has("t")) {
                request.headers.Authorization =
                  "Bearer " + pageUrlParams.get("t");
              }
              const response = await fetch(
                "https://omnipresence24824.activehosted.com/proc.php?jsonp=true",
                request
              );

              return response.json();
            }
            if (formSupportsPost) {
              submitForm()
                .then((data) => {
                  eval(data.js);
                })
                .catch(() => {
                  _show_error(
                    "7",
                    "Sorry, your submission failed. Please try again."
                  );
                });
            } else {
              _load_script(
                "https://omnipresence24824.activehosted.com/proc.php?" +
                  serialized +
                  "&jsonp=true",
                null,
                true
              );
            }
          }
          return false;
        };
        addEvent(form_to_submit, "submit", form_submit);
      })();
    </script>
    <script>
      let selectedIntent = null;
      let codeSelectedIntent = null;
      let selectedCardIds = []; // ← se llenará al confirmar las 4 cartas iniciales

      window.addEventListener("DOMContentLoaded", () => {
        const intentButtons = document.querySelectorAll(".intent-btn");
        const quizContinue = document.getElementById("quizContinue");

        intentButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            // Remover selección de otros botones y marcar este como activo
            intentButtons.forEach((b) => b.classList.remove("selected"));
            btn.classList.add("selected");

            // Mostrar el botón de continuar si está oculto
            quizContinue.classList.remove("hidden");
            quizContinue.style.display = "block";

            // Scroll suave y foco visual
            setTimeout(() => {
              quizContinue.scrollIntoView({
                behavior: "smooth",
                block: "center",
              });
              quizContinue.focus();
              quizContinue.classList.add("btn-focus-glow");
              setTimeout(
                () => quizContinue.classList.remove("btn-focus-glow"),
                2000
              );
            }, 300);
          });
        });

        //borrar intenciones anteriores;
        localStorage.removeItem("selected_portal_codex");
        localStorage.removeItem("intent_codex");

        // --- Quiz Section ---
        const quizOptions = document.querySelectorAll(".intent-btn");
        const continueBtn = document.getElementById("quizContinue");
        const quizSection = document.getElementById("quizSection");
        //let selectedIntent = null;

        quizOptions.forEach((option) => {
          option.addEventListener("click", () => {
            quizOptions.forEach((o) => o.classList.remove("selected"));
            option.classList.add("selected");
            selectedIntent = option.getAttribute("data-intent");
            codeSelectedIntent = option.getAttribute("data-code");
            continueBtn.disabled = false;
          });
        });

        window.mostrarQuizConTransicion = function () {
          quizSection.style.display = "block";
          quizSection.scrollIntoView({ behavior: "smooth", block: "start" });
        };

        // --- Revelacion ---

        const revelation = document.getElementById("revelation");
        const formSection = document.getElementById("formSection");
        const cards1 = document.querySelectorAll(".revelation-cards .card");

        quizOptions.forEach((option) => {
          option.addEventListener("click", () => {
            quizOptions.forEach((o) => o.classList.remove("selected"));
            option.classList.add("selected");
            selectedIntent = option.getAttribute("data-intent");
            continueBtn.disabled = false;
            continueBtn.innerText = "Enter the Portal ✦";
          });
        });

        continueBtn.addEventListener("click", () => {
          revelation.classList.add("visible");
          continueBtn.style.display = "none";
        });

        cards1.forEach((card1) => {
          card1.addEventListener("click", () => {
            cards1.forEach((c) => c.classList.remove("selected"));
            card1.classList.add("selected");
            formSection.classList.add("visible");
            formSection.scrollIntoView({ behavior: "smooth", block: "start" });
          });
        });

        // --- Selección de Cartas ---
        const cards = document.querySelectorAll(".card");
        const magicMessage = document.getElementById("magicMessage");
        const selectedCards = new Set();

        const selectedCardsView = document.createElement("div");
        selectedCardsView.className = "carousel-container";
        selectedCardsView.id = "selectedCardsView";
        selectedCardsView.style.display = "none";
        selectedCardsView.style.justifyContent = "center";
        document.body.appendChild(selectedCardsView);

        // Contenedor para interpretación + loader
        const interpretationWrapper = document.createElement("div");
        interpretationWrapper.style.display = "flex";
        interpretationWrapper.style.flexDirection = "column";
        interpretationWrapper.style.alignItems = "center";
        interpretationWrapper.style.width = "100%";
        interpretationWrapper.style.boxSizing = "border-box";

        // Elemento de interpretación
        const interpretation = document.createElement("div");
        interpretation.id = "interpretation";
        interpretationWrapper.appendChild(interpretation);

        // Símbolo de carga (spinner)
        const loadingSymbol = document.createElement("div");
        loadingSymbol.className = "symbol";
        loadingSymbol.style.display = "none";

        // Insertar el símbolo ANTES del div de interpretación
        interpretationWrapper.insertBefore(loadingSymbol, interpretation);

        // Añadir todo al DOM
        const anchor = document.getElementById("interpretacion-anchor");
        if (anchor) anchor.appendChild(interpretationWrapper);

        const messages = [
          "Your energy has summoned ancestral symbols",
          "The Codex has responded to your vibration",
          "An inner portal has just opened",
          "The circle is complete — press continue",
          "The fragments have been chosen by your soul",
        ];

        cards.forEach((card) => {
          const title = card.querySelector(".card-title");
          card.addEventListener("click", () => {
            const isSelected = card.classList.contains("selected");
            if (!isSelected && selectedCards.size >= 4) return;

            card.classList.toggle("selected");
            if (!isSelected) {
              selectedCards.add(card);
              if (title) title.style.opacity = "1";
            } else {
              selectedCards.delete(card);
              if (title) title.style.opacity = "0";
            }

            const isFourSelected = selectedCards.size === 4;
            continueButton.classList.toggle("active", isFourSelected);

            if (isFourSelected) {
              const msg = messages[Math.floor(Math.random() * messages.length)];
              magicMessage.innerHTML = `
            <p>${msg}</p>
            <button onclick="document.getElementById('continueButton').scrollIntoView({ behavior: 'smooth' });" style="margin-top: 1rem; padding: 8px 16px; font-size: 1rem; background-color: gold; color: black; border: none; border-radius: 5px; cursor: pointer;">Reveal</button>
          `;
              magicMessage.style.display = "block";
              const last = [...selectedCards][3];
              last.classList.add("glow-temp");
              setTimeout(() => {
                magicMessage.style.display = "none";
                last.classList.remove("glow-temp");
              }, 3000);
            }
          });
        });

        continueButton.addEventListener("click", async () => {
          document
            .querySelectorAll(".carousel-container")
            .forEach((c) => (c.style.display = "none"));
          document
            .querySelectorAll("h2")
            .forEach((h) => (h.style.display = "none"));
          continueButton.style.display = "none";

          selectedCardsView.innerHTML = "";
          selectedCardsView.style.display = "flex";
          selectedCardsView.style.opacity = "1";
          selectedCardsView.classList.remove("hidden");

          const orderedCards = [...selectedCards];
          orderedCards.forEach((card) => {
            const title = card.querySelector(".card-title");
            if (title) title.style.display = "none";
            selectedCardsView.appendChild(card);
          });
          selectedCardIds = orderedCards.map((card) =>
            parseInt(card.getAttribute("data-id"))
          );

          document.getElementById("interpretation").style.display = "block";
          interpretation.innerText =
            "The symbols awaken... the revelation is unfolding...";
          interpretation.classList.remove("hidden");
          loadingSymbol.style.display = "block";

          const ids = orderedCards.map((c) => c.getAttribute("data-id"));
          const payload = {
            selectedCards: ids,
            positions: ["Umbral", "Voz", "Desafío", "Sendero"],
            authKey: "G7!vP2#xQ9$zR4@tN1&kM3*eL6",
            debug: false,
            lang: "en",
          };

          try {
            const result = await fetchWithRetry(payload, 1, 3000);
            loadingSymbol.style.display = "none";
            interpretation.innerText = "";

            const raw = result.prediction || "";
            const lang = payload.lang || "es";

            const regexMap = {
              es: /Umbral:|Voz:|Desafío:|Sendero:/,
              en: /Threshold:|Voice:|Challenge:|Path:/,
            };

            const labelsMap = {
              es: ["Umbral", "Voz", "Desafío", "Sendero"],
              en: ["Threshold", "Voice", "Challenge", "Path"],
            };

            const regex = regexMap[lang];
            const labels = labelsMap[lang];

            const sections = raw.split(regex).slice(1);

            if (sections.length === 4) {
              orderedCards.forEach((card, i) => {
                const cardBlock = document.createElement("div");
                cardBlock.className = "card-interpretation-block vertical";

                const clonedCard = card.cloneNode(true);
                clonedCard.classList.remove("selected", "glow-temp");
                clonedCard.classList.add("static-card");

                const interpretationText = document.createElement("div");
                interpretationText.className = "interpretation-text";
                interpretationText.innerHTML = `<h3>${
                  labels[i]
                }</h3><p>${sections[i].trim()}</p>`;

                cardBlock.appendChild(clonedCard);
                cardBlock.appendChild(interpretationText);
                interpretation.appendChild(cardBlock);

                setTimeout(() => {
                  cardBlock.classList.add("visible");
                  const sound = document.getElementById("chimeSound");
                  if (sound) sound.play();

                  if (i === orderedCards.length - 1 && anchor) {
                    setTimeout(() => {
                      anchor.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                      });
                      selectedCardsView.style.transition = "opacity 1s ease";
                      selectedCardsView.style.opacity = "0";
                      setTimeout(() => {
                        selectedCardsView.classList.add("hidden-space");
                        quizSection.style.display = "block";
                      }, 1000);
                    }, 1000);
                  }
                }, i * 1200);
              });
            } else {
              interpretation.innerHTML = `
        <div class="card-interpretation-block visible" style="flex-direction: column; text-align: left;">
          <p style="color: #FFD700; font-style: italic;">The interpretation could not be split into sections. Below is the full message:</p>
          <div class="interpretation-text" style="margin-top: 1rem;">
            ${raw.replace(/\n/g, "<br>")}
          </div>
        </div>
      `;
              console.warn(
                "[Codex Debug] Unexpected format in Codex response:",
                raw
              );
            }
          } catch (err) {
            loadingSymbol.style.display = "none";
            interpretation.innerText =
              "The portal closed too soon... please try again later.";
            console.error("[Codex Debug] Interpretation error:", err);

            const retryBtn = document.getElementById("retryButton");
            if (retryBtn) {
              retryBtn.style.display = "inline-block";
              retryBtn.onclick = () => {
                retryBtn.style.display = "none";
                continueButton.click();
              };
            }
          }
        });

        async function fetchWithRetry(payload, retries = 1, delay = 3000) {
          try {
            const response = await fetch(
              "https://api.omnipresence.me/api/predict",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              }
            );

            if (!response.ok) throw new Error(`Error ${response.status}`);
            return await response.json();
          } catch (error) {
            if (retries > 0) {
              console.warn(
                `[Codex Debug] Reintentando... (${retries} restantes)`
              );
              await new Promise((res) => setTimeout(res, delay));
              return fetchWithRetry(payload, retries - 1, delay);
            } else {
              throw error;
            }
          }
        }
      });

      const reemplazos = {
        "Atraer abundancia y seguridad financiera": 3,
        "Despertar mi poder interior con autoconfianza": 2,
        "Cultivar relaciones amorosas y conscientes": 4,
        "Sanar mi mundo emocional y físico": 17,
        "Encontrar mi propósito espiritual": 18,
      };

      function obtenerFragmentosFinales(intent, selectedIds) {
        const fragmentosPorIntencion = {
          proposito: [1, 22],
          amor: [14, 16],
          abundancia: [6, 19],
          salud: [6, 11],
          transformacion: [13, 21],
        };

        const reemplazos = {
          proposito: 15,
          amor: 7,
          abundancia: 9,
          salud: 20,
          transformacion: 12,
        };

        const usados = new Set(selectedIds);
        const finales = [];

        // Intentar agregar los recomendados por intención
        const base = fragmentosPorIntencion[intent] || [];
        for (const id of base) {
          if (!usados.has(id)) finales.push(id);
        }

        // Intentar agregar reemplazo
        const reemplazo = reemplazos[intent];
        if (reemplazo && !usados.has(reemplazo) && finales.length < 2) {
          finales.push(reemplazo);
        }

        // Rellenar con aleatorios no usados
        while (finales.length < 2) {
          const randomId = Math.floor(Math.random() * 25) + 1;
          if (!usados.has(randomId) && !finales.includes(randomId)) {
            finales.push(randomId);
          }
        }

        return finales;
      }

      const cartasData = {
        1: {
          nombre: "The Master of the Great Work",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/EvcQpI2534195.jpeg",
        },
        2: {
          nombre: "The Guardian of Silence",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/WXbiaf2534195.jpeg",
        },
        3: {
          nombre: "Genesis in the Retort",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/CtWlzk2534195.jpeg",
        },
        4: {
          nombre: "The Harmony of the Spheres",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/vnenhs2534195.jpeg",
        },
        5: {
          nombre: "The Council of the Arcanes",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/hxFYoC2534195.jpeg",
        },
        6: {
          nombre: "The Inner Sun",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/KeAluq2534195.jpeg",
        },
        7: {
          nombre: "The Compass of the Wise",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/xrJXYj2534195.jpeg",
        },
        8: {
          nombre: "The Crypt of Rebirth",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/mzXXMC2534195.jpeg",
        },
        9: {
          nombre: "The Balance of Opposites",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/XdMAmo2534195.jpeg",
        },
        10: {
          nombre: "The Inner Labyrinth",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/nCJjFD2534195.jpeg",
        },
        11: {
          nombre: "The Daughter of Water",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/vmFlNG2534195.jpeg",
        },
        12: {
          nombre: "The Bath of the Red King",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/mJtfJH2534195.jpeg",
        },
        13: {
          nombre: "The Robe of the Soul",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/pdfLCl2534195.jpeg",
        },
        14: {
          nombre: "The Work Completed",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/DLBPqw2534195.jpeg",
        },
        15: {
          nombre: "The Philosophical Tree",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/itywin2534195.jpeg",
        },
        16: {
          nombre: "The Voice of Air",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/kBdqjf2534195.jpeg",
        },
        17: {
          nombre: "The Cosmic Egg",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/csLeJF2534195.jpeg",
        },
        18: {
          nombre: "The Sacred Dwelling",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/srtYYL2534195.jpeg",
        },
        19: {
          nombre: "The Twin Sun",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/uDFgMI2534195.jpeg",
        },
        20: {
          nombre: "Divine Geometry",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/rthpYG2534195.jpeg",
        },
        21: {
          nombre: "The Stone of Chaos",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/WNvcRP2534195.jpeg",
        },
        22: {
          nombre: "The Infinite Path",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/EHzxmw2534195.jpeg",
        },
        23: {
          nombre: "The Guardian of the Threshold",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/rflFDD2534195.jpeg",
        },
        24: {
          nombre: "The Fortress of Brotherhood",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/KzjuNX2534195.jpeg",
        },
        25: {
          nombre: "The Living Circle",
          img: "https://media.atomicatpages.net/u/VKdhbutUBLg5pZCmDWr4fJf466f1/Pictures/XFsdYD2534195.jpeg",
        },
      };

      async function revealTextByWords(container, text, delay = 60) {
        container.innerHTML = "";
        const words = text.split(/\s+/);
        for (let i = 0; i < words.length; i++) {
          container.innerHTML += words[i] + " ";
          await new Promise((res) => setTimeout(res, delay));
        }
      }

      async function fetchFinalSynthesis(
        intent,
        selectedIds,
        retries = 2,
        delay = 3000
      ) {
        const payload = {
          selectedCards: selectedIds,
          intent: intent,
          authKey: "G7!vP2#xQ9$zR4@tN1&kM3*eL6",
          debug: false,
          lang: "en",
        };

        try {
          const res = await fetch(
            "https://api.omnipresence.me/api/revelacion-intencion",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            }
          );

          if (!res.ok) throw new Error(`Error HTTP ${res.status}`);
          const data = await res.json();
          return data.synthesis || "The revelation could not be completed.";
        } catch (err) {
          console.warn(
            `[Codex Debug] Retrying final synthesis... (${retries} restantes)`,
            err
          );

          if (retries > 0) {
            await new Promise((res) => setTimeout(res, delay));
            return fetchFinalSynthesis(intent, selectedIds, retries - 1, delay);
          } else {
            console.error(
              "[Codex Debug] Error retrieving final synthesis:",
              err
            );
            return "The portal closed too soon. Please try again later.";
          }
        }
      }

      async function mostrarCartasFinales(intent, selectedIds) {
        const synthesisSection = document.getElementById(
          "finalSynthesisSection"
        );
        const synthesisText = document.getElementById("finalSynthesisText");
        const revelation = document.getElementById("revelation");
        const container = document.querySelector(".revelation-cards");

        container.innerHTML = "";
        synthesisSection.classList.remove("hidden");
        synthesisText.querySelector(".loading").innerHTML =
          '<div class="symbol"></div><p class="intro-description">The attunement with the Codex is underway......</p>';
        synthesisSection.scrollIntoView({ behavior: "smooth" });

        const texto = await fetchFinalSynthesis(intent, selectedIds);

        //const texto = 'En el corazón del buscador yace un sol interior, una llama eterna que arde con el fuego del conocimiento y la transformación. Esta luz, más que cegadora, es iluminadora, revelando las sombras internas y mostrando el camino hacia la abundancia. Aquel que se alinea con su propia luz, encuentra la fuerza para trascender la oscuridad y abrirse a nuevas posibilidades.'
        /*<div id="animatedText"  class="intro-description"  style="text-align: left;"></div>*/

        synthesisText.innerHTML = `
        <div class="synthesis-title">
          THE CODEX HAS REVEALED THE SYNTHESIS OF YOUR PATH:
        </div>
        <p class="intro-revelacion">
          What unfolds before you is a symbolic and personal interpretation, shaped from the fragments you yourself selected. Each word is carefully woven to reflect your true intention and the phase of the journey you're now walking.
        </p>
        <div id="animatedText" class="loading"></div>
      `;

        /*
    synthesisText.innerHTML = `
    <h2 class="synthesis-title">EL CODEX HA REVELADO LA SÍNTESIS DE TU CAMINO:</h2>
    <div id="animatedText"  class="intro-description"></div>
`     ;*/

        document.getElementById("animatedText").innerHTML = texto;
        synthesisText.classList.add("visible");

        const finales = obtenerFragmentosFinales(intent, selectedIds);
        finales.forEach((id) => {
          const data = cartasData[id];
          if (!data) return;

          const card = document.createElement("div");
          card.className = "card final-choice-card dynamically-added"; // ← aquí agregamos la clase adicional
          card.dataset.id = id;
          card.innerHTML = `
      <img src="${data.img}" alt="${data.nombre}">
      <div class="card-title">${data.nombre}</div>
    `;

          document.addEventListener("click", function (e) {
            const clickedCard = e.target.closest(".card.final-choice-card");
            if (!clickedCard) return;

            const finalId = parseInt(clickedCard.dataset.id, 10);
            document
              .querySelectorAll(".revelation-cards .card")
              .forEach((c) => c.classList.remove("selected"));

            clickedCard.classList.add("selected");

            if (selectedCardIds.length >= 5) {
              // Reemplaza la última carta seleccionada por la nueva
              selectedCardIds[selectedCardIds.length - 1] = finalId;
            } else {
              selectedCardIds.push(finalId);
            }

            // Mostrar formulario suavemente
            const form = document.getElementById("formSection");
            form.classList.add("visible");
            form.scrollIntoView({ behavior: "smooth" });
          });

          container.appendChild(card);

          setTimeout(() => {
            const latestCard = container.querySelector(
              `.card[data-id="${id}"]`
            );
            if (latestCard) {
              latestCard.addEventListener("click", () => {
                latestCard.classList.add("selected");
                // resto de lógica
              });
            }
          }, 10);
        });

        setTimeout(() => {
          revelation.classList.remove("hidden");
          revelation.classList.add("visible");
          //revelation.scrollIntoView({ behavior: 'smooth' });
        }, 800);
      }

      async function fetchFinalSynthesis(
        intent,
        selectedIds,
        retries = 2,
        delay = 3000
      ) {
        const payload = {
          selectedCards: selectedIds,
          intent: intent,
          authKey: "G7!vP2#xQ9$zR4@tN1&kM3*eL6",
          debug: false,
          lang: "en",
        };

        try {
          const res = await fetch(
            "https://api.omnipresence.me/api/revelacion-intencion",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            }
          );

          if (!res.ok) throw new Error(`Error HTTP ${res.status}`);
          const data = await res.json();
          return data.synthesis || "The revelation could not be completed.";
        } catch (err) {
          console.warn(
            `[Codex Debug] Retrying final synthesis... (${retries} restantes)`,
            err
          );

          if (retries > 0) {
            await new Promise((res) => setTimeout(res, delay));
            return fetchFinalSynthesis(intent, selectedIds, retries - 1, delay);
          } else {
            console.error(
              "[[Codex Debug] Failed to obtain final synthesis:",
              err
            );
            return "The portal closed too soon. Please try again later";
          }
        }
      }

      async function revealTextByWords(text, targetElement, delay = 80) {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = text.trim(); // ← contiene el HTML completo generado por la IA

        const paragraphs = tempDiv.querySelectorAll("p");
        for (const p of paragraphs) {
          const clone = document.createElement("p");
          targetElement.appendChild(clone);

          const nodes = Array.from(p.childNodes);
          for (const node of nodes) {
            if (node.nodeType === Node.TEXT_NODE) {
              const words = node.textContent.trim().split(/\s+/);
              for (const word of words) {
                clone.innerHTML += `${word} `;
                clone.scrollIntoView({ behavior: "smooth", block: "end" });
                await new Promise((res) => setTimeout(res, delay));
              }
            } else {
              // Si es un nodo con HTML (ej: <span>), lo añadimos directamente
              clone.appendChild(node.cloneNode(true));
              await new Promise((res) => setTimeout(res, delay));
            }
          }

          await new Promise((res) => setTimeout(res, delay * 10)); // pausa entre párrafos
        }
      }

      document.getElementById("quizContinue").addEventListener("click", () => {
        if (!selectedIntent || selectedCardIds.length !== 4) {
          alert(
            "Debes seleccionar una intención y 4 cartas antes de continuar."
          );
          return;
        }

        mostrarCartasFinales(selectedIntent, selectedCardIds);
      });

      // Suponiendo que ya tienes un array con las 5 cartas seleccionadas
      // Este ejemplo asume que lo tienes como: const selectedCards = [3, 7, 10, 15, 22];

      function guardarCartasSeleccionadasEnLocalStorage() {
        if (selectedCardIds.length === 5) {
          localStorage.setItem(
            "selected_portal_codex",
            JSON.stringify(selectedCardIds)
          );
        } else {
          console.warn("There aren't 5 selected fragments yet.");
        }
      }
      function guardarIntencionSeleccionadaEnLocalStorage() {
        if (selectedIntent) {
          localStorage.setItem("intent_codex", selectedIntent);
          localStorage.setItem("code_intent_codex", codeSelectedIntent);
        } else {
          console.warn("⚠ No intent selected yet.");
        }
      }
    </script>

    <div
      id="legalNotice"
      style="
        text-align: center;
        font-size: 0.75rem;
        margin-top: 2.5rem;
        margin-bottom: 3rem;
        color: #ccc;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 1.2s ease, transform 1.2s ease;
      "
    >
      © 2025 <strong>Omnipresence ®</strong> — All rights reserved
      <br />
      <a
        href="https://www.hermetic-codex.com/terms"
        target="_blank"
        style="color: #ffd700aa; text-decoration: none"
        >Terms of Service</a
      >
      ·
      <a
        href="https://www.hermetic-codex.com/privacy"
        target="_blank"
        style="color: #ffd700aa; text-decoration: none"
        >Privacy Policy</a
      >
    </div>
  </body>
</html>
